# ç¬¬ä¸‰ç«  Python çš„æ•°æ®ç»“æ„ã€å‡½æ•°å’Œæ–‡ä»¶

> ğŸ¹ æœ¬ç« è®¨è®ºPythonçš„å†…ç½®åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æœ¬ä¹¦ä¼šç”¨åˆ°å¾ˆå¤šã€‚è™½ç„¶æ‰©å±•åº“ï¼Œæ¯”å¦‚pandaså’ŒNumpyï¼Œä½¿å¤„ç†å¤§æ•°æ®é›†å¾ˆæ–¹ä¾¿ï¼Œä½†å®ƒä»¬æ˜¯å’ŒPythonçš„å†…ç½®æ•°æ®å¤„ç†å·¥å…·ä¸€åŒä½¿ç”¨çš„ã€‚
>
> æˆ‘ä»¬ä¼šä»Pythonæœ€åŸºç¡€çš„æ•°æ®ç»“æ„å¼€å§‹ï¼šå…ƒç»„ã€åˆ—è¡¨ã€å­—å…¸å’Œé›†åˆã€‚ç„¶åä¼šè®¨è®ºåˆ›å»ºä½ è‡ªå·±çš„ã€å¯é‡å¤ä½¿ç”¨çš„Pythonå‡½æ•°ã€‚æœ€åï¼Œä¼šå­¦ä¹ Pythonçš„æ–‡ä»¶å¯¹è±¡ï¼Œä»¥åŠå¦‚ä½•ä¸æœ¬åœ°ç¡¬ç›˜äº¤äº’ã€‚

# 3.1 æ•°æ®ç»“æ„å’Œåºåˆ—
Pythonçš„æ•°æ®ç»“æ„ç®€å•è€Œå¼ºå¤§ã€‚é€šæ™“å®ƒä»¬æ‰èƒ½æˆä¸ºç†Ÿç»ƒçš„Pythonç¨‹åºå‘˜ã€‚

## 3.1.1 å…ƒç»„
å…ƒç»„æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦ï¼Œä¸å¯æ”¹å˜çš„Pythonåºåˆ—å¯¹è±¡ã€‚åˆ›å»ºå…ƒç»„çš„æœ€ç®€å•æ–¹å¼ï¼Œæ˜¯ç”¨é€—å·åˆ†éš”ä¸€åˆ—å€¼ï¼š

```python
In [1]: tup = 4, 5, 6

In [2]: tup
Out[2]: (4, 5, 6)
```

å½“ç”¨å¤æ‚çš„è¡¨è¾¾å¼å®šä¹‰å…ƒç»„ï¼Œæœ€å¥½å°†å€¼æ”¾åˆ°åœ†æ‹¬å·å†…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
In [3]: nested_tup = (4, 5, 6), (7, 8)

In [4]: nested_tup
Out[4]: ((4, 5, 6), (7, 8))
```

ç”¨``tuple``å¯ä»¥å°†ä»»æ„åºåˆ—æˆ–è¿­ä»£å™¨è½¬æ¢æˆå…ƒç»„ï¼š

```python
In [5]: tuple([4, 0, 2])
Out[5]: (4, 0, 2)

In [6]: tup = tuple('string')

In [7]: tup
Out[7]: ('s', 't', 'r', 'i', 'n', 'g')
```

å¯ä»¥ç”¨æ–¹æ‹¬å·è®¿é—®å…ƒç»„ä¸­çš„å…ƒç´ ã€‚å’ŒCã€C++ã€JAVAç­‰è¯­è¨€ä¸€æ ·ï¼Œåºåˆ—æ˜¯ä»0å¼€å§‹çš„ï¼š

```python
In [8]: tup[0]
Out[8]: 's'
```

å…ƒç»„ä¸­å­˜å‚¨çš„å¯¹è±¡å¯èƒ½æ˜¯å¯å˜å¯¹è±¡ã€‚**ä¸€æ—¦åˆ›å»ºäº†å…ƒç»„ï¼Œå…ƒç»„ä¸­çš„å¯¹è±¡å°±ä¸èƒ½ä¿®æ”¹äº†**ï¼š

```python
In [9]: tup = tuple(['foo', [1, 2], True])

In [10]: tup[2] = False
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-10-c7308343b841> in <module>()
----> 1 tup[2] = False
TypeError: 'tuple' object does not support item assignment
```

å¦‚æœå…ƒç»„ä¸­çš„æŸä¸ªå¯¹è±¡æ˜¯å¯å˜çš„ï¼Œæ¯”å¦‚åˆ—è¡¨ï¼Œå¯ä»¥åœ¨åŸä½è¿›è¡Œä¿®æ”¹ï¼š

```python
In [11]: tup[1].append(3)

In [12]: tup
Out[12]: ('foo', [1, 2, 3], True)
```

å¯ä»¥ç”¨åŠ å·è¿ç®—ç¬¦å°†å…ƒç»„ä¸²è”èµ·æ¥ï¼š

```python
In [13]: (4, None, 'foo') + (6, 0) + ('bar',)
Out[13]: (4, None, 'foo', 6, 0, 'bar')
```

å…ƒç»„ä¹˜ä»¥ä¸€ä¸ªæ•´æ•°ï¼Œåƒåˆ—è¡¨ä¸€æ ·ï¼Œä¼šå°†å‡ ä¸ªå…ƒç»„çš„å¤åˆ¶ä¸²è”èµ·æ¥ï¼š

```python
In [14]: ('foo', 'bar') * 4
Out[14]: ('foo', 'bar', 'foo', 'bar', 'foo', 'bar', 'foo', 'bar')
```

å¯¹è±¡æœ¬èº«å¹¶æ²¡æœ‰è¢«å¤åˆ¶ï¼Œåªæ˜¯å¼•ç”¨äº†å®ƒã€‚

## 3.1.2 æ‹†åˆ†å…ƒç»„
å¦‚æœä½ æƒ³å°†å…ƒç»„èµ‹å€¼ç»™ç±»ä¼¼å…ƒç»„çš„å˜é‡ï¼ŒPythonä¼šè¯•å›¾æ‹†åˆ†ç­‰å·å³è¾¹çš„å€¼ï¼š

```python
In [15]: tup = (4, 5, 6)

In [16]: a, b, c = tup

In [17]: b
Out[17]: 5
```

å³ä½¿å«æœ‰å…ƒç»„çš„å…ƒç»„ä¹Ÿä¼šè¢«æ‹†åˆ†ï¼š

```python
In [18]: tup = 4, 5, (6, 7)

In [19]: a, b, (c, d) = tup

In [20]: d
Out[20]: 7
```

ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æ›¿æ¢å˜é‡çš„åå­—ï¼Œå…¶å®ƒè¯­è¨€å¯èƒ½æ˜¯è¿™æ ·ï¼š

```python
tmp = a
a = b
b = tmp
```

ä½†æ˜¯åœ¨Pythonä¸­ï¼Œæ›¿æ¢å¯ä»¥è¿™æ ·åšï¼š

```python
In [21]: a, b = 1, 2

In [22]: a
Out[22]: 1

In [23]: b
Out[23]: 2

In [24]: b, a = a, b

In [25]: a
Out[25]: 2

In [26]: b
Out[26]: 1
```

å˜é‡æ‹†åˆ†å¸¸ç”¨æ¥è¿­ä»£å…ƒç»„æˆ–åˆ—è¡¨åºåˆ—ï¼š

```python
In [27]: seq = [(1, 2, 3), (4, 5, 6), (7, 8, 9)]

In [28]: for a, b, c in seq:
   ....:     print('a={0}, b={1}, c={2}'.format(a, b, c))
a=1, b=2, c=3
a=4, b=5, c=6
a=7, b=8, c=9
```

å¦ä¸€ä¸ªå¸¸è§ç”¨æ³•æ˜¯ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼ã€‚åé¢ä¼šè¯¦è§£ã€‚

Pythonæœ€è¿‘æ–°å¢äº†æ›´å¤šé«˜çº§çš„å…ƒç»„æ‹†åˆ†åŠŸèƒ½ï¼Œå…è®¸ä»å…ƒç»„çš„å¼€å¤´â€œæ‘˜å–â€å‡ ä¸ªå…ƒç´ ã€‚å®ƒä½¿ç”¨äº†ç‰¹æ®Šçš„è¯­æ³•``*rest``ï¼Œè¿™ä¹Ÿç”¨åœ¨å‡½æ•°ç­¾åä¸­ä»¥æŠ“å–ä»»æ„é•¿åº¦åˆ—è¡¨çš„ä½ç½®å‚æ•°ï¼š

```python
In [29]: values = 1, 2, 3, 4, 5

In [30]: a, b, *rest = values

In [31]: a, b
Out[31]: (1, 2)

In [32]: rest
Out[32]: [3, 4, 5]
```

``rest``çš„éƒ¨åˆ†æ˜¯æƒ³è¦èˆå¼ƒçš„éƒ¨åˆ†ï¼Œrestçš„åå­—ä¸é‡è¦ã€‚ä½œä¸ºæƒ¯ç”¨å†™æ³•ï¼Œè®¸å¤šPythonç¨‹åºå‘˜ä¼šå°†ä¸éœ€è¦çš„å˜é‡ä½¿ç”¨ä¸‹åˆ’çº¿ï¼š

```python
In [33]: a, b, *_ = values
```

## 3.1.3 tupleæ–¹æ³•
å› ä¸ºå…ƒç»„çš„å¤§å°å’Œå†…å®¹ä¸èƒ½ä¿®æ”¹ï¼Œå®ƒçš„å®ä¾‹æ–¹æ³•éƒ½å¾ˆè½»é‡ã€‚å…¶ä¸­ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å°±æ˜¯``count``ï¼ˆä¹Ÿé€‚ç”¨äºåˆ—è¡¨ï¼‰ï¼Œå®ƒå¯ä»¥ç»Ÿè®¡æŸä¸ªå€¼å¾—å‡ºç°é¢‘ç‡ï¼š

```python
In [34]: a = (1, 2, 2, 2, 3, 4, 2)

In [35]: a.count(2)
Out[35]: 4
```

## 3.1.4 åˆ—è¡¨
ä¸å…ƒç»„å¯¹æ¯”ï¼Œåˆ—è¡¨çš„é•¿åº¦å¯å˜ã€å†…å®¹å¯ä»¥è¢«ä¿®æ”¹ã€‚ä½ å¯ä»¥ç”¨æ–¹æ‹¬å·å®šä¹‰ï¼Œæˆ–ç”¨``list``å‡½æ•°ï¼š

```python
In [36]: a_list = [2, 3, 7, None]

In [37]: tup = ('foo', 'bar', 'baz')

In [38]: b_list = list(tup)

In [39]: b_list
Out[39]: ['foo', 'bar', 'baz']

In [40]: b_list[1] = 'peekaboo'

In [41]: b_list
Out[41]: ['foo', 'peekaboo', 'baz']
```

åˆ—è¡¨å’Œå…ƒç»„çš„è¯­ä¹‰æ¥è¿‘ï¼Œåœ¨è®¸å¤šå‡½æ•°ä¸­å¯ä»¥äº¤å‰ä½¿ç”¨ã€‚

``list``å‡½æ•°å¸¸ç”¨æ¥åœ¨æ•°æ®å¤„ç†ä¸­å®ä½“åŒ–è¿­ä»£å™¨æˆ–ç”Ÿæˆå™¨ï¼š

```python
In [42]: gen = range(10)

In [43]: gen
Out[43]: range(0, 10)

In [44]: list(gen)
Out[44]: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
```

## 3.1.5 æ·»åŠ å’Œåˆ é™¤å…ƒç´ 
å¯ä»¥ç”¨``append``åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼š

```python
In [45]: b_list.append('dwarf')

In [46]: b_list
Out[46]: ['foo', 'peekaboo', 'baz', 'dwarf']
```

``insert``å¯ä»¥åœ¨ç‰¹å®šçš„ä½ç½®æ’å…¥å…ƒç´ ï¼š

```python
In [47]: b_list.insert(1, 'red')

In [48]: b_list
Out[48]: ['foo', 'red', 'peekaboo', 'baz', 'dwarf']
```

æ’å…¥çš„åºå·å¿…é¡»åœ¨0å’Œåˆ—è¡¨é•¿åº¦ä¹‹é—´ã€‚

>è­¦å‘Šï¼šä¸``append``ç›¸æ¯”ï¼Œ``insert``è€—è´¹çš„è®¡ç®—é‡å¤§ï¼Œå› ä¸ºå¯¹åç»­å…ƒç´ çš„å¼•ç”¨å¿…é¡»åœ¨å†…éƒ¨è¿ç§»ï¼Œä»¥ä¾¿ä¸ºæ–°å…ƒç´ æä¾›ç©ºé—´ã€‚å¦‚æœè¦åœ¨åºåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨æ’å…¥å…ƒç´ ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨``collections.deque``ï¼Œä¸€ä¸ªåŒå°¾éƒ¨é˜Ÿåˆ—ã€‚

insertçš„é€†è¿ç®—æ˜¯popï¼Œå®ƒç§»é™¤å¹¶è¿”å›æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼š

```python
In [49]: b_list.pop(2)
Out[49]: 'peekaboo'

In [50]: b_list
Out[50]: ['foo', 'red', 'baz', 'dwarf']
```

å¯ä»¥ç”¨``remove``å»é™¤æŸä¸ªå€¼ï¼Œ``remove``ä¼šå…ˆå¯»æ‰¾ç¬¬ä¸€ä¸ªå€¼å¹¶é™¤å»ï¼š

```python
In [51]: b_list.append('foo')

In [52]: b_list
Out[52]: ['foo', 'red', 'baz', 'dwarf', 'foo']

In [53]: b_list.remove('foo')

In [54]: b_list
Out[54]: ['red', 'baz', 'dwarf', 'foo']
```

å¦‚æœä¸è€ƒè™‘æ€§èƒ½ï¼Œä½¿ç”¨``append``å’Œ``remove``ï¼Œå¯ä»¥æŠŠPythonçš„åˆ—è¡¨å½“åšå®Œç¾çš„â€œå¤šé‡é›†â€æ•°æ®ç»“æ„ã€‚

ç”¨``in``å¯ä»¥æ£€æŸ¥åˆ—è¡¨æ˜¯å¦åŒ…å«æŸä¸ªå€¼ï¼š

```python
In [55]: 'dwarf' in b_list
Out[55]: True
```

å¦å®š``in``å¯ä»¥å†åŠ ä¸€ä¸ªnotï¼š

```python
In [56]: 'dwarf' not in b_list
Out[56]: False
```

åœ¨åˆ—è¡¨ä¸­æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸä¸ªå€¼è¿œæ¯”å­—å…¸å’Œé›†åˆé€Ÿåº¦æ…¢ï¼Œå› ä¸ºPythonæ˜¯**çº¿æ€§æœç´¢**åˆ—è¡¨ä¸­çš„å€¼ï¼Œä½†åœ¨å­—å…¸å’Œé›†åˆä¸­ï¼Œåœ¨åŒæ ·çš„æ—¶é—´å†…è¿˜å¯ä»¥æ£€æŸ¥å…¶å®ƒé¡¹ï¼ˆåŸºäºå“ˆå¸Œè¡¨ï¼‰ã€‚

## 3.1.6 ä¸²è”å’Œç»„åˆåˆ—è¡¨
ä¸å…ƒç»„ç±»ä¼¼ï¼Œå¯ä»¥ç”¨åŠ å·å°†ä¸¤ä¸ªåˆ—è¡¨ä¸²è”èµ·æ¥ï¼š

```python
In [57]: [4, None, 'foo'] + [7, 8, (2, 3)]
Out[57]: [4, None, 'foo', 7, 8, (2, 3)]
```

å¦‚æœå·²ç»å®šä¹‰äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨``extend``æ–¹æ³•å¯ä»¥è¿½åŠ å¤šä¸ªå…ƒç´ ï¼š

```python
In [58]: x = [4, None, 'foo']

In [59]: x.extend([7, 8, (2, 3)])

In [60]: x
Out[60]: [4, None, 'foo', 7, 8, (2, 3)]
```

é€šè¿‡åŠ æ³•å°†åˆ—è¡¨ä¸²è”çš„è®¡ç®—é‡è¾ƒå¤§ï¼Œå› ä¸ºè¦æ–°å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œå¹¶ä¸”è¦å¤åˆ¶å¯¹è±¡ã€‚ç”¨``extend``è¿½åŠ å…ƒç´ ï¼Œå°¤å…¶æ˜¯åˆ°ä¸€ä¸ªå¤§åˆ—è¡¨ä¸­ï¼Œæ›´ä¸ºå¯å–ã€‚å› æ­¤ï¼š

```python
everything = []
for chunk in list_of_lists:
    everything.extend(chunk)
```

è¦æ¯”ä¸²è”æ–¹æ³•å¿«ï¼š

```python
everything = []
for chunk in list_of_lists:
    everything = everything + chunk
```

## 3.1.7 æ’åº
ä½ å¯ä»¥ç”¨``sort``å‡½æ•°å°†ä¸€ä¸ªåˆ—è¡¨åŸåœ°æ’åºï¼ˆä¸åˆ›å»ºæ–°çš„å¯¹è±¡ï¼‰ï¼š

```python
In [61]: a = [7, 2, 5, 1, 3]

In [62]: a.sort()

In [63]: a
Out[63]: [1, 2, 3, 5, 7]
```

``sort``æœ‰ä¸€äº›é€‰é¡¹ï¼Œæœ‰æ—¶ä¼šå¾ˆå¥½ç”¨ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯äºŒçº§æ’åºkeyï¼Œå¯ä»¥ç”¨è¿™ä¸ªkeyè¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰é•¿åº¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ’åºï¼š

```python
In [64]: b = ['saw', 'small', 'He', 'foxes', 'six']

In [65]: b.sort(key=len)

In [66]: b
Out[66]: ['He', 'saw', 'six', 'small', 'foxes']
```

ç¨åï¼Œæˆ‘ä»¬ä¼šå­¦ä¹ ``sorted``å‡½æ•°ï¼Œå®ƒå¯ä»¥äº§ç”Ÿä¸€ä¸ªæ’å¥½åºçš„åºåˆ—å‰¯æœ¬ã€‚

## 3.1.8 äºŒåˆ†æœç´¢å’Œç»´æŠ¤å·²æ’åºçš„åˆ—è¡¨
``bisect``æ¨¡å—æ”¯æŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå’Œå‘å·²æ’åºçš„åˆ—è¡¨æ’å…¥å€¼ã€‚``bisect.bisect``å¯ä»¥æ‰¾åˆ°æ’å…¥å€¼åä»ä¿è¯æ’åºçš„ä½ç½®ï¼Œ``bisect.insort``æ˜¯å‘è¿™ä¸ªä½ç½®æ’å…¥å€¼ï¼š

```python
In [67]: import bisect

In [68]: c = [1, 2, 2, 2, 3, 4, 7]

In [69]: bisect.bisect(c, 2)
Out[69]: 4

In [70]: bisect.bisect(c, 5)
Out[70]: 6

In [71]: bisect.insort(c, 6)

In [72]: c
Out[72]: [1, 2, 2, 2, 3, 4, 6, 7]
```

>æ³¨æ„ï¼š``bisect``æ¨¡å—ä¸ä¼šæ£€æŸ¥åˆ—è¡¨æ˜¯å¦å·²æ’å¥½åºï¼Œè¿›è¡Œæ£€æŸ¥çš„è¯ä¼šè€—è´¹å¤§é‡è®¡ç®—ã€‚å› æ­¤ï¼Œå¯¹æœªæ’åºçš„åˆ—è¡¨ä½¿ç”¨``bisect``ä¸ä¼šäº§ç”Ÿé”™è¯¯ï¼Œä½†ç»“æœä¸ä¸€å®šæ­£ç¡®ã€‚

## 3.1.9 åˆ‡ç‰‡
ç”¨åˆ‡è¾¹å¯ä»¥é€‰å–å¤§å¤šæ•°åºåˆ—ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œåˆ‡ç‰‡çš„åŸºæœ¬å½¢å¼æ˜¯åœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨``start:stop``ï¼š

```python
In [73]: seq = [7, 2, 3, 7, 5, 6, 0, 1]

In [74]: seq[1:5]
Out[74]: [2, 3, 7, 5]
```

åˆ‡ç‰‡ä¹Ÿå¯ä»¥è¢«åºåˆ—èµ‹å€¼ï¼š
```python
In [75]: seq[3:4] = [6, 3]

In [76]: seq
Out[76]: [7, 2, 3, 6, 3, 5, 6, 0, 1]
```

åˆ‡ç‰‡çš„èµ·å§‹å…ƒç´ æ˜¯åŒ…æ‹¬çš„ï¼Œä¸åŒ…å«ç»“æŸå…ƒç´ ã€‚å› æ­¤ï¼Œç»“æœä¸­åŒ…å«çš„å…ƒç´ ä¸ªæ•°æ˜¯``stop - start``ã€‚

``start``æˆ–``stop``éƒ½å¯ä»¥è¢«çœç•¥ï¼Œçœç•¥ä¹‹åï¼Œåˆ†åˆ«é»˜è®¤åºåˆ—çš„å¼€å¤´å’Œç»“å°¾ï¼š

```python
In [77]: seq[:5]
Out[77]: [7, 2, 3, 6, 3]

In [78]: seq[3:]
Out[78]: [6, 3, 5, 6, 0, 1]
```

è´Ÿæ•°è¡¨æ˜ä»åå‘å‰åˆ‡ç‰‡ï¼š

```python
In [79]: seq[-4:]
Out[79]: [5, 6, 0, 1]

In [80]: seq[-6:-2]
Out[80]: [6, 3, 5, 6]
```

éœ€è¦ä¸€æ®µæ—¶é—´æ¥ç†Ÿæ‚‰ä½¿ç”¨åˆ‡ç‰‡ï¼Œå°¤å…¶æ˜¯å½“ä½ ä¹‹å‰å­¦çš„æ˜¯Ræˆ–MATLABã€‚å›¾3-1å±•ç¤ºäº†æ­£æ•´æ•°å’Œè´Ÿæ•´æ•°çš„åˆ‡ç‰‡ã€‚åœ¨å›¾ä¸­ï¼ŒæŒ‡æ•°æ ‡ç¤ºåœ¨è¾¹ç¼˜ä»¥è¡¨æ˜åˆ‡ç‰‡æ˜¯åœ¨å“ªé‡Œå¼€å§‹å“ªé‡Œç»“æŸçš„ã€‚

![å›¾3-1 Pythonåˆ‡ç‰‡æ¼”ç¤º](http://upload-images.jianshu.io/upload_images/7178691-522e2b688b755ff3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

åœ¨ç¬¬äºŒä¸ªå†’å·åé¢ä½¿ç”¨``step``ï¼Œå¯ä»¥éš”ä¸€ä¸ªå–ä¸€ä¸ªå…ƒç´ ï¼š

```python
In [81]: seq[::2]
Out[81]: [7, 3, 3, 6, 1]
```

ä¸€ä¸ªèªæ˜çš„æ–¹æ³•æ˜¯ä½¿ç”¨``-1``ï¼Œå®ƒå¯ä»¥å°†åˆ—è¡¨æˆ–å…ƒç»„é¢ å€’è¿‡æ¥ï¼š

```python
In [82]: seq[::-1]
Out[82]: [1, 0, 6, 5, 3, 6, 3, 2, 7]
```

## 3.1.10 åºåˆ—å‡½æ•°
Pythonæœ‰ä¸€äº›æœ‰ç”¨çš„åºåˆ—å‡½æ•°ã€‚

## 3.1.11 enumerateå‡½æ•°
è¿­ä»£ä¸€ä¸ªåºåˆ—æ—¶ï¼Œä½ å¯èƒ½æƒ³è·Ÿè¸ªå½“å‰é¡¹çš„åºå·ã€‚æ‰‹åŠ¨çš„æ–¹æ³•å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·ï¼š

```python
i = 0
for value in collection:
   # do something with value
   i += 1
```

å› ä¸ºè¿™ä¹ˆåšå¾ˆå¸¸è§ï¼ŒPythonå†…å»ºäº†ä¸€ä¸ª``enumerate``å‡½æ•°ï¼Œå¯ä»¥è¿”å›``(i, value)``å…ƒç»„åºåˆ—ï¼š

```python
for i, value in enumerate(collection):
   # do something with value
```

å½“ä½ ç´¢å¼•æ•°æ®æ—¶ï¼Œä½¿ç”¨`enumerate`çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯è®¡ç®—åºåˆ—ï¼ˆå”¯ä¸€çš„ï¼‰``dict``æ˜ å°„åˆ°ä½ç½®çš„å€¼ï¼š

```python
In [83]: some_list = ['foo', 'bar', 'baz']

In [84]: mapping = {}

In [85]: for i, v in enumerate(some_list):
   ....:     mapping[v] = i

In [86]: mapping
Out[86]: {'bar': 1, 'baz': 2, 'foo': 0}
```

## 3.1.12 sortedå‡½æ•°
``sorted``å‡½æ•°å¯ä»¥ä»ä»»æ„åºåˆ—çš„å…ƒç´ è¿”å›ä¸€ä¸ªæ–°çš„æ’å¥½åºçš„åˆ—è¡¨ï¼š

```python
In [87]: sorted([7, 1, 2, 6, 0, 3, 2])
Out[87]: [0, 1, 2, 2, 3, 6, 7]

In [88]: sorted('horse race')
Out[88]: [' ', 'a', 'c', 'e', 'e', 'h', 'o', 'r', 'r', 's']
```

``sorted``å‡½æ•°å¯ä»¥æ¥å—å’Œ``sort``ç›¸åŒçš„å‚æ•°ã€‚

## 3.1.13 zipå‡½æ•°
``zip``å¯ä»¥å°†å¤šä¸ªåˆ—è¡¨ã€å…ƒç»„æˆ–å…¶å®ƒåºåˆ—æˆå¯¹ç»„åˆæˆä¸€ä¸ªå…ƒç»„åˆ—è¡¨ï¼š

```python
In [89]: seq1 = ['foo', 'bar', 'baz']

In [90]: seq2 = ['one', 'two', 'three']

In [91]: zipped = zip(seq1, seq2)

In [92]: list(zipped)
Out[92]: [('foo', 'one'), ('bar', 'two'), ('baz', 'three')]
```

``zip``å¯ä»¥å¤„ç†ä»»æ„å¤šçš„åºåˆ—ï¼Œå…ƒç´ çš„ä¸ªæ•°å–å†³äºæœ€çŸ­çš„åºåˆ—ï¼š

```python
In [93]: seq3 = [False, True]

In [94]: list(zip(seq1, seq2, seq3))
Out[94]: [('foo', 'one', False), ('bar', 'two', True)]
```

``zip``çš„å¸¸è§ç”¨æ³•ä¹‹ä¸€æ˜¯åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—ï¼Œå¯èƒ½ç»“åˆ``enumerate``ä½¿ç”¨ï¼š

```python
In [95]: for i, (a, b) in enumerate(zip(seq1, seq2)):
   ....:     print('{0}: {1}, {2}'.format(i, a, b))
   ....:
0: foo, one
1: bar, two
2: baz, three
```

ç»™å‡ºä¸€ä¸ªâ€œè¢«å‹ç¼©çš„â€åºåˆ—ï¼Œ``zip``å¯ä»¥è¢«ç”¨æ¥è§£å‹åºåˆ—ã€‚ä¹Ÿå¯ä»¥å½“ä½œæŠŠè¡Œçš„åˆ—è¡¨è½¬æ¢ä¸ºåˆ—çš„åˆ—è¡¨ã€‚è¿™ä¸ªæ–¹æ³•çœ‹èµ·æ¥æœ‰ç‚¹ç¥å¥‡ï¼š

```python
In [96]: pitchers = [('Nolan', 'Ryan'), ('Roger', 'Clemens'),
   ....:             ('Schilling', 'Curt')]

In [97]: first_names, last_names = zip(*pitchers)

In [98]: first_names
Out[98]: ('Nolan', 'Roger', 'Schilling')

In [99]: last_names
Out[99]: ('Ryan', 'Clemens', 'Curt')
```

## 3.1.14 reversedå‡½æ•°
``reversed``å¯ä»¥ä»åå‘å‰è¿­ä»£ä¸€ä¸ªåºåˆ—ï¼š

```python
In [100]: list(reversed(range(10)))
Out[100]: [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
```

è¦è®°ä½``reversed``æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆåé¢è¯¦ç»†ä»‹ç»ï¼‰ï¼Œåªæœ‰å®ä½“åŒ–ï¼ˆå³åˆ—è¡¨æˆ–forå¾ªç¯ï¼‰ä¹‹åæ‰èƒ½åˆ›å»º**ç¿»è½¬**çš„åºåˆ—ã€‚

## 3.1.15 å­—å…¸
å­—å…¸å¯èƒ½æ˜¯Pythonæœ€ä¸ºé‡è¦çš„æ•°æ®ç»“æ„ã€‚å®ƒæ›´ä¸ºå¸¸è§çš„åå­—æ˜¯å“ˆå¸Œæ˜ å°„æˆ–å…³è”æ•°ç»„ã€‚å®ƒæ˜¯é”®å€¼å¯¹çš„å¤§å°å¯å˜é›†åˆï¼Œé”®å’Œå€¼éƒ½æ˜¯Pythonå¯¹è±¡ã€‚åˆ›å»ºå­—å…¸çš„æ–¹æ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨å°–æ‹¬å·ï¼Œç”¨å†’å·åˆ†éš”é”®å’Œå€¼ï¼š

```python
In [101]: empty_dict = {}

In [102]: d1 = {'a' : 'some value', 'b' : [1, 2, 3, 4]}

In [103]: d1
Out[103]: {'a': 'some value', 'b': [1, 2, 3, 4]}
```

ä½ å¯ä»¥åƒè®¿é—®åˆ—è¡¨æˆ–å…ƒç»„ä¸­çš„å…ƒç´ ä¸€æ ·ï¼Œè®¿é—®ã€æ’å…¥æˆ–è®¾å®šå­—å…¸ä¸­çš„å…ƒç´ ï¼š

```python
In [104]: d1[7] = 'an integer'

In [105]: d1
Out[105]: {'a': 'some value', 'b': [1, 2, 3, 4], 7: 'an integer'}

In [106]: d1['b']
Out[106]: [1, 2, 3, 4]
```

ä½ å¯ä»¥ç”¨æ£€æŸ¥åˆ—è¡¨å’Œå…ƒç»„æ˜¯å¦åŒ…å«æŸä¸ªå€¼çš„æ–¹æ³•ï¼Œæ£€æŸ¥å­—å…¸ä¸­æ˜¯å¦åŒ…å«æŸä¸ªé”®ï¼š

```python
In [107]: 'b' in d1
Out[107]: True
```

å¯ä»¥ç”¨``del``å…³é”®å­—æˆ–``pop``æ–¹æ³•ï¼ˆè¿”å›å€¼çš„åŒæ—¶åˆ é™¤é”®ï¼‰åˆ é™¤å€¼ï¼š

```python
In [108]: d1[5] = 'some value'

In [109]: d1
Out[109]: 
{'a': 'some value',
 'b': [1, 2, 3, 4],
 7: 'an integer',
 5: 'some value'}

In [110]: d1['dummy'] = 'another value'

In [111]: d1
Out[111]: 
{'a': 'some value',
 'b': [1, 2, 3, 4],
 7: 'an integer',
 5: 'some value',
 'dummy': 'another value'}

In [112]: del d1[5]

In [113]: d1
Out[113]: 
{'a': 'some value',
 'b': [1, 2, 3, 4],
 7: 'an integer',
 'dummy': 'another value'}

In [114]: ret = d1.pop('dummy')

In [115]: ret
Out[115]: 'another value'

In [116]: d1
Out[116]: {'a': 'some value', 'b': [1, 2, 3, 4], 7: 'an integer'}
```

``keys``å’Œ``values``æ˜¯å­—å…¸çš„é”®å’Œå€¼çš„è¿­ä»£å™¨æ–¹æ³•ã€‚è™½ç„¶é”®å€¼å¯¹æ²¡æœ‰é¡ºåºï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥ç”¨ç›¸åŒçš„é¡ºåºè¾“å‡ºé”®å’Œå€¼ï¼š

```python
In [117]: list(d1.keys())
Out[117]: ['a', 'b', 7]

In [118]: list(d1.values())
Out[118]: ['some value', [1, 2, 3, 4], 'an integer']
```

ç”¨``update``æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªå­—å…¸ä¸å¦ä¸€ä¸ªèåˆï¼š
```python
In [119]: d1.update({'b' : 'foo', 'c' : 12})

In [120]: d1
Out[120]: {'a': 'some value', 'b': 'foo', 7: 'an integer', 'c': 12}
```

``update``æ–¹æ³•æ˜¯åŸåœ°æ”¹å˜å­—å…¸ï¼Œå› æ­¤ä»»ä½•ä¼ é€’ç»™``update``çš„é”®çš„æ—§çš„å€¼éƒ½ä¼šè¢«èˆå¼ƒã€‚

## 3.1.16 ç”¨åºåˆ—åˆ›å»ºå­—å…¸
å¸¸å¸¸ï¼Œä½ å¯èƒ½æƒ³å°†ä¸¤ä¸ªåºåˆ—é…å¯¹ç»„åˆæˆå­—å…¸ã€‚ä¸‹é¢æ˜¯ä¸€ç§å†™æ³•ï¼š

```python
mapping = {}
for key, value in zip(key_list, value_list):
    mapping[key] = value
```

å› ä¸ºå­—å…¸æœ¬è´¨ä¸Šæ˜¯2å…ƒå…ƒç»„çš„é›†åˆï¼Œdictå¯ä»¥æ¥å—2å…ƒå…ƒç»„çš„åˆ—è¡¨ï¼š
```python
In [121]: mapping = dict(zip(range(5), reversed(range(5))))

In [122]: mapping
Out[122]: {0: 4, 1: 3, 2: 2, 3: 1, 4: 0}
```

åé¢ä¼šè°ˆåˆ°``dict comprehensions``ï¼Œå¦ä¸€ç§æ„å»ºå­—å…¸çš„ä¼˜é›…æ–¹å¼ã€‚

## 3.1.17 é»˜è®¤å€¼
ä¸‹é¢çš„é€»è¾‘å¾ˆå¸¸è§ï¼š

```python
if key in some_dict:
    value = some_dict[key]
else:
    value = default_value
```

å› æ­¤ï¼Œdictçš„æ–¹æ³•getå’Œpopå¯ä»¥å–é»˜è®¤å€¼è¿›è¡Œè¿”å›ï¼Œä¸Šé¢çš„if-elseè¯­å¥å¯ä»¥ç®€å†™æˆä¸‹é¢ï¼š
```python
value = some_dict.get(key, default_value)
```

geté»˜è®¤ä¼šè¿”å›Noneï¼Œå¦‚æœä¸å­˜åœ¨é”®ï¼Œpopä¼šæŠ›å‡ºä¸€ä¸ªä¾‹å¤–ã€‚å…³äºè®¾å®šå€¼ï¼Œå¸¸è§çš„æƒ…å†µæ˜¯åœ¨å­—å…¸çš„å€¼æ˜¯å±äºå…¶å®ƒé›†åˆï¼Œå¦‚åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡é¦–å­—æ¯ï¼Œå°†ä¸€ä¸ªåˆ—è¡¨ä¸­çš„å•è¯åˆ†ç±»ï¼š
```python
In [123]: words = ['apple', 'bat', 'bar', 'atom', 'book']

In [124]: by_letter = {}

In [125]: for word in words:
   .....:     letter = word[0]
   .....:     if letter not in by_letter:
   .....:         by_letter[letter] = [word]
   .....:     else:
   .....:         by_letter[letter].append(word)
   .....:

In [126]: by_letter
Out[126]: {'a': ['apple', 'atom'], 'b': ['bat', 'bar', 'book']}
```

``setdefault``æ–¹æ³•å°±æ­£æ˜¯å¹²è¿™ä¸ªçš„ã€‚å‰é¢çš„forå¾ªç¯å¯ä»¥æ”¹å†™ä¸ºï¼š
```python
for word in words:
    letter = word[0]
    by_letter.setdefault(letter, []).append(word)
```

``collections``æ¨¡å—æœ‰ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„ç±»ï¼Œ``defaultdict``ï¼Œå®ƒå¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ä¸Šé¢ã€‚ä¼ é€’ç±»å‹æˆ–å‡½æ•°ä»¥ç”Ÿæˆæ¯ä¸ªä½ç½®çš„é»˜è®¤å€¼ï¼š
```python
from collections import defaultdict
by_letter = defaultdict(list)
for word in words:
    by_letter[word[0]].append(word)
```

## 3.1.18 æœ‰æ•ˆçš„é”®ç±»å‹
å­—å…¸çš„å€¼å¯ä»¥æ˜¯ä»»æ„Pythonå¯¹è±¡ï¼Œè€Œé”®é€šå¸¸æ˜¯ä¸å¯å˜çš„æ ‡é‡ç±»å‹ï¼ˆæ•´æ•°ã€æµ®ç‚¹å‹ã€å­—ç¬¦ä¸²ï¼‰æˆ–å…ƒç»„ï¼ˆå…ƒç»„ä¸­çš„å¯¹è±¡å¿…é¡»æ˜¯ä¸å¯å˜çš„ï¼‰ã€‚è¿™è¢«ç§°ä¸ºâ€œå¯å“ˆå¸Œæ€§â€ã€‚å¯ä»¥ç”¨``hash``å‡½æ•°æ£€æµ‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å¯å“ˆå¸Œçš„ï¼ˆå¯è¢«ç”¨ä½œå­—å…¸çš„é”®ï¼‰ï¼š

```python
In [127]: hash('string')
Out[127]: 5023931463650008331

In [128]: hash((1, 2, (2, 3)))
Out[128]: 1097636502276347782

In [129]: hash((1, 2, [2, 3])) # fails because lists are mutable
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-129-800cd14ba8be> in <module>()
----> 1 hash((1, 2, [2, 3])) # fails because lists are mutable
TypeError: unhashable type: 'list'
```

è¦ç”¨åˆ—è¡¨å½“åšé”®ï¼Œä¸€ç§æ–¹æ³•æ˜¯å°†åˆ—è¡¨è½¬åŒ–ä¸ºå…ƒç»„ï¼Œåªè¦å†…éƒ¨å…ƒç´ å¯ä»¥è¢«å“ˆå¸Œï¼Œå®ƒä¹Ÿå°±å¯ä»¥è¢«å“ˆå¸Œï¼š
```python
In [130]: d = {}

In [131]: d[tuple([1, 2, 3])] = 5

In [132]: d
Out[132]: {(1, 2, 3): 5}
```

## 3.1.19 é›†åˆ
é›†åˆæ˜¯æ— åºçš„ä¸å¯é‡å¤çš„å…ƒç´ çš„é›†åˆã€‚ä½ å¯ä»¥æŠŠå®ƒå½“åšå­—å…¸ï¼Œä½†æ˜¯åªæœ‰é”®æ²¡æœ‰å€¼ã€‚å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼åˆ›å»ºé›†åˆï¼šé€šè¿‡setå‡½æ•°æˆ–ä½¿ç”¨å°–æ‹¬å·setè¯­å¥ï¼š

```python
In [133]: set([2, 2, 2, 1, 3, 3])
Out[133]: {1, 2, 3}

In [134]: {2, 2, 2, 1, 3, 3}
Out[134]: {1, 2, 3}
```

é›†åˆæ”¯æŒåˆå¹¶ã€äº¤é›†ã€å·®åˆ†å’Œå¯¹ç§°å·®ç­‰æ•°å­¦é›†åˆè¿ç®—ã€‚è€ƒè™‘ä¸¤ä¸ªç¤ºä¾‹é›†åˆï¼š

```python
In [135]: a = {1, 2, 3, 4, 5}

In [136]: b = {3, 4, 5, 6, 7, 8}
```

åˆå¹¶æ˜¯å–ä¸¤ä¸ªé›†åˆä¸­ä¸é‡å¤çš„å…ƒç´ ã€‚å¯ä»¥ç”¨``union``æ–¹æ³•ï¼Œæˆ–è€…``|``è¿ç®—ç¬¦ï¼š

```python
In [137]: a.union(b)
Out[137]: {1, 2, 3, 4, 5, 6, 7, 8}

In [138]: a | b
Out[138]: {1, 2, 3, 4, 5, 6, 7, 8}
```

äº¤é›†çš„å…ƒç´ åŒ…å«åœ¨ä¸¤ä¸ªé›†åˆä¸­ã€‚å¯ä»¥ç”¨``intersection``æˆ–``&``è¿ç®—ç¬¦ï¼š

```python
In [139]: a.intersection(b)
Out[139]: {3, 4, 5}

In [140]: a & b
Out[140]: {3, 4, 5}
```

è¡¨3-1åˆ—å‡ºäº†å¸¸ç”¨çš„é›†åˆæ–¹æ³•ã€‚

![è¡¨3-1 Pythonçš„é›†åˆæ“ä½œ](https://gitee.com/wugenqiang/images/raw/master/01/1240-20201009182930366.png)

æ‰€æœ‰é€»è¾‘é›†åˆæ“ä½œéƒ½æœ‰å¦å¤–çš„åŸåœ°å®ç°æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ç”¨ç»“æœæ›¿ä»£é›†åˆçš„å†…å®¹ã€‚å¯¹äºå¤§çš„é›†åˆï¼Œè¿™ä¹ˆåšæ•ˆç‡æ›´é«˜ï¼š

```python
In [141]: c = a.copy()

In [142]: c |= b

In [143]: c
Out[143]: {1, 2, 3, 4, 5, 6, 7, 8}

In [144]: d = a.copy()

In [145]: d &= b

In [146]: d
Out[146]: {3, 4, 5}
```

ä¸å­—å…¸ç±»ä¼¼ï¼Œé›†åˆå…ƒç´ é€šå¸¸éƒ½æ˜¯ä¸å¯å˜çš„ã€‚è¦è·å¾—ç±»ä¼¼åˆ—è¡¨çš„å…ƒç´ ï¼Œå¿…é¡»è½¬æ¢æˆå…ƒç»„ï¼š

```python
In [147]: my_data = [1, 2, 3, 4]

In [148]: my_set = {tuple(my_data)}

In [149]: my_set
Out[149]: {(1, 2, 3, 4)}
```

ä½ è¿˜å¯ä»¥æ£€æµ‹ä¸€ä¸ªé›†åˆæ˜¯å¦æ˜¯å¦ä¸€ä¸ªé›†åˆçš„å­é›†æˆ–çˆ¶é›†ï¼š

```python
In [150]: a_set = {1, 2, 3, 4, 5}

In [151]: {1, 2, 3}.issubset(a_set)
Out[151]: True

In [152]: a_set.issuperset({1, 2, 3})
Out[152]: True
```

é›†åˆçš„å†…å®¹ç›¸åŒæ—¶ï¼Œé›†åˆæ‰å¯¹ç­‰ï¼š

```python
In [153]: {1, 2, 3} == {3, 2, 1}
Out[153]: True
```

## 3.1.20 åˆ—è¡¨ã€é›†åˆå’Œå­—å…¸æ¨å¯¼å¼
åˆ—è¡¨æ¨å¯¼å¼æ˜¯Pythonæœ€å—å–œçˆ±çš„ç‰¹æ€§ä¹‹ä¸€ã€‚å®ƒå…è®¸ç”¨æˆ·æ–¹ä¾¿çš„ä»ä¸€ä¸ªé›†åˆè¿‡æ»¤å…ƒç´ ï¼Œå½¢æˆåˆ—è¡¨ï¼Œåœ¨ä¼ é€’å‚æ•°çš„è¿‡ç¨‹ä¸­è¿˜å¯ä»¥ä¿®æ”¹å…ƒç´ ã€‚å½¢å¼å¦‚ä¸‹ï¼š

```python
[expr for val in collection if condition]
```

å®ƒç­‰åŒäºä¸‹é¢çš„forå¾ªç¯;

```python
result = []
for val in collection:
    if condition:
        result.append(expr)
```

filteræ¡ä»¶å¯ä»¥è¢«å¿½ç•¥ï¼Œåªç•™ä¸‹è¡¨è¾¾å¼å°±è¡Œã€‚ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤å‡ºé•¿åº¦åœ¨2åŠä»¥ä¸‹çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è½¬æ¢æˆå¤§å†™ï¼š

```python
In [154]: strings = ['a', 'as', 'bat', 'car', 'dove', 'python']

In [155]: [x.upper() for x in strings if len(x) > 2]
Out[155]: ['BAT', 'CAR', 'DOVE', 'PYTHON']
```

ç”¨ç›¸ä¼¼çš„æ–¹æ³•ï¼Œè¿˜å¯ä»¥æ¨å¯¼é›†åˆå’Œå­—å…¸ã€‚å­—å…¸çš„æ¨å¯¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š

```python
dict_comp = {key-expr : value-expr for value in collection if condition}
```

é›†åˆçš„æ¨å¯¼å¼ä¸åˆ—è¡¨å¾ˆåƒï¼Œåªä¸è¿‡ç”¨çš„æ˜¯å°–æ‹¬å·ï¼š

```python
set_comp = {expr for value in collection if condition}
```

ä¸åˆ—è¡¨æ¨å¯¼å¼ç±»ä¼¼ï¼Œé›†åˆä¸å­—å…¸çš„æ¨å¯¼ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œè€Œä¸”ä½¿ä»£ç çš„è¯»å†™éƒ½å¾ˆå®¹æ˜“ã€‚æ¥çœ‹å‰é¢çš„å­—ç¬¦ä¸²åˆ—è¡¨ã€‚å‡å¦‚æˆ‘ä»¬åªæƒ³è¦å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç”¨é›†åˆæ¨å¯¼å¼çš„æ–¹æ³•éå¸¸æ–¹ä¾¿ï¼š

```python
In [156]: unique_lengths = {len(x) for x in strings}

In [157]: unique_lengths
Out[157]: {1, 2, 3, 4, 6}
```

``map``å‡½æ•°å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ï¼š

```python
In [158]: set(map(len, strings))
Out[158]: {1, 2, 3, 4, 6}
```

ä½œä¸ºä¸€ä¸ªå­—å…¸æ¨å¯¼å¼çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²çš„æŸ¥æ‰¾æ˜ å°„è¡¨ä»¥ç¡®å®šå®ƒåœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼š

```python
In [159]: loc_mapping = {val : index for index, val in enumerate(strings)}

In [160]: loc_mapping
Out[160]: {'a': 0, 'as': 1, 'bat': 2, 'car': 3, 'dove': 4, 'python': 5}
```

## 3.1.21 åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«åˆ—è¡¨çš„åˆ—è¡¨ï¼ŒåŒ…å«äº†ä¸€äº›è‹±æ–‡åå’Œè¥¿ç­ç‰™åï¼š

```python
In [161]: all_data = [['John', 'Emily', 'Michael', 'Mary', 'Steven'],
   .....:             ['Maria', 'Juan', 'Javier', 'Natalia', 'Pilar']]
```

ä½ å¯èƒ½æ˜¯ä»ä¸€äº›æ–‡ä»¶å¾—åˆ°çš„è¿™äº›åå­—ï¼Œç„¶åæƒ³æŒ‰ç…§è¯­è¨€è¿›è¡Œåˆ†ç±»ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬æƒ³ç”¨ä¸€ä¸ªåˆ—è¡¨åŒ…å«æ‰€æœ‰çš„åå­—ï¼Œè¿™äº›åå­—ä¸­åŒ…å«ä¸¤ä¸ªæˆ–æ›´å¤šçš„eã€‚å¯ä»¥ç”¨forå¾ªç¯æ¥åšï¼š

```python
names_of_interest = []
for names in all_data:
    enough_es = [name for name in names if name.count('e') >= 2]
    names_of_interest.extend(enough_es)
```

å¯ä»¥ç”¨åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼çš„æ–¹æ³•ï¼Œå°†è¿™äº›å†™åœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
In [162]: result = [name for names in all_data for name in names
   .....:           if name.count('e') >= 2]

In [163]: result
Out[163]: ['Steven']
```

åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼çœ‹èµ·æ¥æœ‰äº›å¤æ‚ã€‚åˆ—è¡¨æ¨å¯¼å¼çš„foréƒ¨åˆ†æ˜¯æ ¹æ®åµŒå¥—çš„é¡ºåºï¼Œè¿‡æ»¤æ¡ä»¶è¿˜æ˜¯æ”¾åœ¨æœ€åã€‚ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªæ•´æ•°å…ƒç»„çš„åˆ—è¡¨æ‰å¹³åŒ–æˆäº†ä¸€ä¸ªæ•´æ•°åˆ—è¡¨ï¼š

```python
In [164]: some_tuples = [(1, 2, 3), (4, 5, 6), (7, 8, 9)]

In [165]: flattened = [x for tup in some_tuples for x in tup]

In [166]: flattened
Out[166]: [1, 2, 3, 4, 5, 6, 7, 8, 9]
```

è®°ä½ï¼Œforè¡¨è¾¾å¼çš„é¡ºåºæ˜¯ä¸åµŒå¥—forå¾ªç¯çš„é¡ºåºä¸€æ ·ï¼ˆè€Œä¸æ˜¯åˆ—è¡¨æ¨å¯¼å¼çš„é¡ºåºï¼‰ï¼š

```python
flattened = []

for tup in some_tuples:
    for x in tup:
        flattened.append(x)
```

ä½ å¯ä»¥æœ‰ä»»æ„å¤šçº§åˆ«çš„åµŒå¥—ï¼Œä½†æ˜¯å¦‚æœä½ æœ‰ä¸¤ä¸‰ä¸ªä»¥ä¸Šçš„åµŒå¥—ï¼Œä½ å°±åº”è¯¥è€ƒè™‘ä¸‹ä»£ç å¯è¯»æ€§çš„é—®é¢˜äº†ã€‚åˆ†è¾¨åˆ—è¡¨æ¨å¯¼å¼çš„åˆ—è¡¨æ¨å¯¼å¼ä¸­çš„è¯­æ³•ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼š

```python
In [167]: [[x for x in tup] for tup in some_tuples]
Out[167]: [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
```

è¿™æ®µä»£ç äº§ç”Ÿäº†ä¸€ä¸ªåˆ—è¡¨çš„åˆ—è¡¨ï¼Œè€Œä¸æ˜¯æ‰å¹³åŒ–çš„åªåŒ…å«å…ƒç´ çš„åˆ—è¡¨ã€‚

# 3.2 å‡½æ•°
å‡½æ•°æ˜¯Pythonä¸­æœ€ä¸»è¦ä¹Ÿæ˜¯æœ€é‡è¦çš„ä»£ç ç»„ç»‡å’Œå¤ç”¨æ‰‹æ®µã€‚ä½œä¸ºæœ€é‡è¦çš„åŸåˆ™ï¼Œå¦‚æœä½ è¦é‡å¤ä½¿ç”¨ç›¸åŒæˆ–éå¸¸ç±»ä¼¼çš„ä»£ç ï¼Œå°±éœ€è¦å†™ä¸€ä¸ªå‡½æ•°ã€‚é€šè¿‡ç»™å‡½æ•°èµ·ä¸€ä¸ªåå­—ï¼Œè¿˜å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚

å‡½æ•°ä½¿ç”¨``def``å…³é”®å­—å£°æ˜ï¼Œç”¨``return``å…³é”®å­—è¿”å›å€¼ï¼š

```python
def my_function(x, y, z=1.5):
    if z > 1:
        return z * (x + y)
    else:
        return z / (x + y)
```

åŒæ—¶æ‹¥æœ‰å¤šæ¡returnè¯­å¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å¦‚æœåˆ°è¾¾å‡½æ•°æœ«å°¾æ—¶æ²¡æœ‰é‡åˆ°ä»»ä½•ä¸€æ¡returnè¯­å¥ï¼Œåˆ™è¿”å›Noneã€‚

å‡½æ•°å¯ä»¥æœ‰ä¸€äº›ä½ç½®å‚æ•°ï¼ˆpositionalï¼‰å’Œä¸€äº›å…³é”®å­—å‚æ•°ï¼ˆkeywordï¼‰ã€‚å…³é”®å­—å‚æ•°é€šå¸¸ç”¨äºæŒ‡å®šé»˜è®¤å€¼æˆ–å¯é€‰å‚æ•°ã€‚åœ¨ä¸Šé¢çš„å‡½æ•°ä¸­ï¼Œxå’Œyæ˜¯ä½ç½®å‚æ•°ï¼Œè€Œzåˆ™æ˜¯å…³é”®å­—å‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥å‡½æ•°å¯ä»¥ä¸‹é¢è¿™ä¸¤ç§æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼š

```python
my_function(5, 6, z=0.7)
my_function(3.14, 7, 3.5)
my_function(10, 20)
```

å‡½æ•°å‚æ•°çš„ä¸»è¦é™åˆ¶åœ¨äºï¼šå…³é”®å­—å‚æ•°å¿…é¡»ä½äºä½ç½®å‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¹‹åã€‚ä½ å¯ä»¥ä»»ä½•é¡ºåºæŒ‡å®šå…³é”®å­—å‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸ç”¨æ­»è®°ç¡¬èƒŒå‡½æ•°å‚æ•°çš„é¡ºåºï¼Œåªè¦è®°å¾—å®ƒä»¬çš„åå­—å°±å¯ä»¥äº†ã€‚

>ç¬”è®°ï¼šä¹Ÿå¯ä»¥ç”¨å…³é”®å­—ä¼ é€’ä½ç½®å‚æ•°ã€‚å‰é¢çš„ä¾‹å­ï¼Œä¹Ÿå¯ä»¥å†™ä¸ºï¼š
>```python
>my_function(x=5, y=6, z=7)
>my_function(y=6, x=5, z=7)
>```
>è¿™ç§å†™æ³•å¯ä»¥æé«˜å¯è¯»æ€§ã€‚

## 3.2.1 å‘½åç©ºé—´ã€ä½œç”¨åŸŸï¼Œå’Œå±€éƒ¨å‡½æ•°
å‡½æ•°å¯ä»¥è®¿é—®ä¸¤ç§ä¸åŒä½œç”¨åŸŸä¸­çš„å˜é‡ï¼šå…¨å±€ï¼ˆglobalï¼‰å’Œå±€éƒ¨ï¼ˆlocalï¼‰ã€‚Pythonæœ‰ä¸€ç§æ›´ç§‘å­¦çš„ç”¨äºæè¿°å˜é‡ä½œç”¨åŸŸçš„åç§°ï¼Œå³å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ã€‚ä»»ä½•åœ¨å‡½æ•°ä¸­èµ‹å€¼çš„å˜é‡é»˜è®¤éƒ½æ˜¯è¢«åˆ†é…åˆ°å±€éƒ¨å‘½åç©ºé—´ï¼ˆlocal namespaceï¼‰ä¸­çš„ã€‚å±€éƒ¨å‘½åç©ºé—´æ˜¯åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶åˆ›å»ºçš„ï¼Œå‡½æ•°å‚æ•°ä¼šç«‹å³å¡«å…¥è¯¥å‘½åç©ºé—´ã€‚åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå±€éƒ¨å‘½åç©ºé—´å°±ä¼šè¢«é”€æ¯ï¼ˆä¼šæœ‰ä¸€äº›ä¾‹å¤–çš„æƒ…å†µï¼Œå…·ä½“è¯·å‚è§åé¢ä»‹ç»é—­åŒ…çš„é‚£ä¸€èŠ‚ï¼‰ã€‚çœ‹çœ‹ä¸‹é¢è¿™ä¸ªå‡½æ•°ï¼š

```python
def func():
    a = []
    for i in range(5):
        a.append(i)
```

è°ƒç”¨func()ä¹‹åï¼Œé¦–å…ˆä¼šåˆ›å»ºå‡ºç©ºåˆ—è¡¨aï¼Œç„¶åæ·»åŠ 5ä¸ªå…ƒç´ ï¼Œæœ€åaä¼šåœ¨è¯¥å‡½æ•°é€€å‡ºçš„æ—¶å€™è¢«é”€æ¯ã€‚å‡å¦‚æˆ‘ä»¬åƒä¸‹é¢è¿™æ ·å®šä¹‰aï¼š

```python
a = []
def func():
    for i in range(5):
        a.append(i)
```

è™½ç„¶å¯ä»¥åœ¨å‡½æ•°ä¸­å¯¹å…¨å±€å˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œä½†æ˜¯é‚£äº›å˜é‡å¿…é¡»ç”¨globalå…³é”®å­—å£°æ˜æˆå…¨å±€çš„æ‰è¡Œï¼š

```python
In [168]: a = None

In [169]: def bind_a_variable():
   .....:     global a
   .....:     a = []
   .....: bind_a_variable()
   .....:

In [170]: print(a)
[]
```

>æ³¨æ„ï¼šæˆ‘å¸¸å¸¸å»ºè®®äººä»¬ä¸è¦é¢‘ç¹ä½¿ç”¨globalå…³é”®å­—ã€‚å› ä¸ºå…¨å±€å˜é‡ä¸€èˆ¬æ˜¯ç”¨äºå­˜æ”¾ç³»ç»Ÿçš„æŸäº›çŠ¶æ€çš„ã€‚å¦‚æœä½ å‘ç°è‡ªå·±ç”¨äº†å¾ˆå¤šï¼Œé‚£å¯èƒ½å°±è¯´æ˜å¾—è¦æ¥ç‚¹å„¿é¢å‘å¯¹è±¡ç¼–ç¨‹äº†ï¼ˆå³ä½¿ç”¨ç±»ï¼‰ã€‚

## 3.2.2 è¿”å›å¤šä¸ªå€¼
åœ¨æˆ‘ç¬¬ä¸€æ¬¡ç”¨Pythonç¼–ç¨‹æ—¶ï¼ˆä¹‹å‰å·²ç»ä¹ æƒ¯äº†Javaå’ŒC++ï¼‰ï¼Œæœ€å–œæ¬¢çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼šå‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```python
def f():
    a = 5
    b = 6
    c = 7
    return a, b, c

a, b, c = f()
```

åœ¨æ•°æ®åˆ†æå’Œå…¶ä»–ç§‘å­¦è®¡ç®—åº”ç”¨ä¸­ï¼Œä½ ä¼šå‘ç°è‡ªå·±å¸¸å¸¸è¿™ä¹ˆå¹²ã€‚è¯¥å‡½æ•°å…¶å®åªè¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œæœ€åè¯¥å…ƒç»„ä¼šè¢«æ‹†åŒ…åˆ°å„ä¸ªç»“æœå˜é‡ä¸­ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·å†™ï¼š

```python
return_valueÂ =Â f()
```

è¿™é‡Œçš„return_valueå°†ä¼šæ˜¯ä¸€ä¸ªå«æœ‰3ä¸ªè¿”å›å€¼çš„ä¸‰å…ƒå…ƒç»„ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§éå¸¸å…·æœ‰å¸å¼•åŠ›çš„å¤šå€¼è¿”å›æ–¹å¼â€”â€”è¿”å›å­—å…¸ï¼š

```python
def f():
    a = 5
    b = 6
    c = 7
    return {'a' : a, 'b' : b, 'c' : c}
```

å–å†³äºå·¥ä½œå†…å®¹ï¼Œç¬¬äºŒç§æ–¹æ³•å¯èƒ½å¾ˆæœ‰ç”¨ã€‚

## 3.2.3 å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡
ç”±äºPythonå‡½æ•°éƒ½æ˜¯å¯¹è±¡ï¼Œå› æ­¤ï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­è¾ƒéš¾è¡¨è¾¾çš„ä¸€äº›è®¾è®¡æ€æƒ³åœ¨Pythonä¸­å°±è¦ç®€å•å¾ˆå¤šäº†ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¸Œæœ›å¯¹å…¶è¿›è¡Œä¸€äº›æ•°æ®æ¸…ç†å·¥ä½œå¹¶æ‰§è¡Œä¸€å †è½¬æ¢ï¼š

```python
In [171]: states = ['   Alabama ', 'Georgia!', 'Georgia', 'georgia', 'FlOrIda',
   .....:           'south   carolina##', 'West virginia?']
```

ä¸ç®¡æ˜¯è°ï¼Œåªè¦å¤„ç†è¿‡ç”±ç”¨æˆ·æäº¤çš„è°ƒæŸ¥æ•°æ®ï¼Œå°±èƒ½æ˜ç™½è¿™ç§ä¹±ä¸ƒå…«ç³Ÿçš„æ•°æ®æ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚ä¸ºäº†å¾—åˆ°ä¸€ç»„èƒ½ç”¨äºåˆ†æå·¥ä½œçš„æ ¼å¼ç»Ÿä¸€çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦åšå¾ˆå¤šäº‹æƒ…ï¼šå»é™¤ç©ºç™½ç¬¦ã€åˆ é™¤å„ç§æ ‡ç‚¹ç¬¦å·ã€æ­£ç¡®çš„å¤§å†™æ ¼å¼ç­‰ã€‚åšæ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨å†…å»ºçš„å­—ç¬¦ä¸²æ–¹æ³•å’Œæ­£åˆ™è¡¨è¾¾å¼``re``æ¨¡å—ï¼š

```python
import re

def clean_strings(strings):
    result = []
    for value in strings:
        value = value.strip()
        value = re.sub('[!#?]', '', value)
        value = value.title()
        result.append(value)
    return result
```

ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
In [173]: clean_strings(states)
Out[173]: 
['Alabama',
 'Georgia',
 'Georgia',
 'Georgia',
 'Florida',
 'South   Carolina',
 'West Virginia']
```

å…¶å®è¿˜æœ‰å¦å¤–ä¸€ç§ä¸é”™çš„åŠæ³•ï¼šå°†éœ€è¦åœ¨ä¸€ç»„ç»™å®šå­—ç¬¦ä¸²ä¸Šæ‰§è¡Œçš„æ‰€æœ‰è¿ç®—åšæˆä¸€ä¸ªåˆ—è¡¨ï¼š

```python
def remove_punctuation(value):
    return re.sub('[!#?]', '', value)

clean_ops = [str.strip, remove_punctuation, str.title]

def clean_strings(strings, ops):
    result = []
    for value in strings:
        for function in ops:
            value = function(value)
        result.append(value)
    return result
```

ç„¶åæˆ‘ä»¬å°±æœ‰äº†ï¼š

```python
In [175]: clean_strings(states, clean_ops)
Out[175]: 
['Alabama',
 'Georgia',
 'Georgia',
 'Georgia',
 'Florida',
 'South   Carolina',
 'West Virginia']
```

è¿™ç§å¤šå‡½æ•°æ¨¡å¼ä½¿ä½ èƒ½åœ¨å¾ˆé«˜çš„å±‚æ¬¡ä¸Šè½»æ¾ä¿®æ”¹å­—ç¬¦ä¸²çš„è½¬æ¢æ–¹å¼ã€‚æ­¤æ—¶çš„clean_stringsä¹Ÿæ›´å…·å¯å¤ç”¨æ€§ï¼

è¿˜å¯ä»¥å°†å‡½æ•°ç”¨ä½œå…¶ä»–å‡½æ•°çš„å‚æ•°ï¼Œæ¯”å¦‚å†…ç½®çš„mapå‡½æ•°ï¼Œå®ƒç”¨äºåœ¨ä¸€ç»„æ•°æ®ä¸Šåº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼š

```python
In [176]: for x in map(remove_punctuation, states):
   .....:     print(x)
Alabama 
Georgia
Georgia
georgia
FlOrIda
south   carolina
West virginia
```

## 3.2.4 åŒ¿åï¼ˆlambdaï¼‰å‡½æ•°
Pythonæ”¯æŒä¸€ç§è¢«ç§°ä¸ºåŒ¿åçš„ã€æˆ–lambdaå‡½æ•°ã€‚å®ƒä»…ç”±å•æ¡è¯­å¥ç»„æˆï¼Œè¯¥è¯­å¥çš„ç»“æœå°±æ˜¯è¿”å›å€¼ã€‚å®ƒæ˜¯é€šè¿‡lambdaå…³é”®å­—å®šä¹‰çš„ï¼Œè¿™ä¸ªå…³é”®å­—æ²¡æœ‰åˆ«çš„å«ä¹‰ï¼Œä»…ä»…æ˜¯è¯´â€œæˆ‘ä»¬æ­£åœ¨å£°æ˜çš„æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°â€ã€‚

```python
def short_function(x):
    return x * 2

equiv_anon = lambda x: x * 2
```

æœ¬ä¹¦å…¶ä½™éƒ¨åˆ†ä¸€èˆ¬å°†å…¶ç§°ä¸ºlambdaå‡½æ•°ã€‚å®ƒä»¬åœ¨æ•°æ®åˆ†æå·¥ä½œä¸­éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºä½ ä¼šå‘ç°å¾ˆå¤šæ•°æ®è½¬æ¢å‡½æ•°éƒ½ä»¥å‡½æ•°ä½œä¸ºå‚æ•°çš„ã€‚ç›´æ¥ä¼ å…¥lambdaå‡½æ•°æ¯”ç¼–å†™å®Œæ•´å‡½æ•°å£°æ˜è¦å°‘è¾“å…¥å¾ˆå¤šå­—ï¼ˆä¹Ÿæ›´æ¸…æ™°ï¼‰ï¼Œç”šè‡³æ¯”å°†lambdaå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡è¿˜è¦å°‘è¾“å…¥å¾ˆå¤šå­—ã€‚çœ‹çœ‹ä¸‹é¢è¿™ä¸ªç®€å•å¾—æœ‰äº›å‚»çš„ä¾‹å­ï¼š

```python
def apply_to_list(some_list, f):
    return [f(x) for x in some_list]

ints = [4, 0, 1, 5, 6]
apply_to_list(ints, lambda x: x * 2)
```

è™½ç„¶ä½ å¯ä»¥ç›´æ¥ç¼–å†™[x *2for x in ints]ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯ä»¥éå¸¸è½»æ¾åœ°ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰è¿ç®—ç»™apply_to_listå‡½æ•°ã€‚

å†æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æœ‰ä¸€ç»„å­—ç¬¦ä¸²ï¼Œä½ æƒ³è¦æ ¹æ®å„å­—ç¬¦ä¸²ä¸åŒå­—æ¯çš„æ•°é‡å¯¹å…¶è¿›è¡Œæ’åºï¼š

```python
In [177]: strings = ['foo', 'card', 'bar', 'aaaa', 'abab']
```

è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªlambdaå‡½æ•°åˆ°åˆ—è¡¨çš„sortæ–¹æ³•ï¼š

```python
In [178]: strings.sort(key=lambda x: len(set(list(x))))

In [179]: strings
Out[179]: ['aaaa', 'foo', 'abab', 'bar', 'card']
```

>ç¬”è®°ï¼šlambdaå‡½æ•°ä¹‹æ‰€ä»¥ä¼šè¢«ç§°ä¸ºåŒ¿åå‡½æ•°ï¼Œä¸defå£°æ˜çš„å‡½æ•°ä¸åŒï¼ŒåŸå› ä¹‹ä¸€å°±æ˜¯è¿™ç§å‡½æ•°å¯¹è±¡æœ¬èº«æ˜¯æ²¡æœ‰æä¾›åç§°__name__å±æ€§ã€‚

## 3.2.5 æŸ¯é‡ŒåŒ–ï¼šéƒ¨åˆ†å‚æ•°åº”ç”¨
æŸ¯é‡ŒåŒ–ï¼ˆcurryingï¼‰æ˜¯ä¸€ä¸ªæœ‰è¶£çš„è®¡ç®—æœºç§‘å­¦æœ¯è¯­ï¼Œå®ƒæŒ‡çš„æ˜¯é€šè¿‡â€œéƒ¨åˆ†å‚æ•°åº”ç”¨â€ï¼ˆpartial argument applicationï¼‰ä»ç°æœ‰å‡½æ•°æ´¾ç”Ÿå‡ºæ–°å‡½æ•°çš„æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ‰§è¡Œä¸¤æ•°ç›¸åŠ çš„ç®€å•å‡½æ•°ï¼š

```python
def add_numbers(x, y):
    return x + y
```

é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ´¾ç”Ÿå‡ºä¸€ä¸ªæ–°çš„åªæœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•°â€”â€”add_fiveï¼Œå®ƒç”¨äºå¯¹å…¶å‚æ•°åŠ 5ï¼š

```python
add_five = lambda y: add_numbers(5, y)
```

add_numbersçš„ç¬¬äºŒä¸ªå‚æ•°ç§°ä¸ºâ€œæŸ¯é‡ŒåŒ–çš„â€ï¼ˆcurriedï¼‰ã€‚è¿™é‡Œæ²¡ä»€ä¹ˆç‰¹åˆ«èŠ±å“¨çš„ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä»¬å…¶å®å°±åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥è°ƒç”¨ç°æœ‰å‡½æ•°çš„æ–°å‡½æ•°è€Œå·²ã€‚å†…ç½®çš„functoolsæ¨¡å—å¯ä»¥ç”¨partialå‡½æ•°å°†æ­¤è¿‡ç¨‹ç®€åŒ–ï¼š
```python
from functools import partial
add_five = partial(add_numbers, 5)
```

## 3.2.6 ç”Ÿæˆå™¨
èƒ½ä»¥ä¸€ç§ä¸€è‡´çš„æ–¹å¼å¯¹åºåˆ—è¿›è¡Œè¿­ä»£ï¼ˆæ¯”å¦‚åˆ—è¡¨ä¸­çš„å¯¹è±¡æˆ–æ–‡ä»¶ä¸­çš„è¡Œï¼‰æ˜¯Pythonçš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹ã€‚è¿™æ˜¯é€šè¿‡ä¸€ç§å«åšè¿­ä»£å™¨åè®®ï¼ˆiterator protocolï¼Œå®ƒæ˜¯ä¸€ç§ä½¿å¯¹è±¡å¯è¿­ä»£çš„é€šç”¨æ–¹å¼ï¼‰çš„æ–¹å¼å®ç°çš„ï¼Œä¸€ä¸ªåŸç”Ÿçš„ä½¿å¯¹è±¡å¯è¿­ä»£çš„æ–¹æ³•ã€‚æ¯”å¦‚è¯´ï¼Œå¯¹å­—å…¸è¿›è¡Œè¿­ä»£å¯ä»¥å¾—åˆ°å…¶æ‰€æœ‰çš„é”®ï¼š

```python
In [180]: some_dict = {'a': 1, 'b': 2, 'c': 3}

In [181]: for key in some_dict:
   .....:     print(key)
a
b
c
```

å½“ä½ ç¼–å†™for key in some_dictæ—¶ï¼ŒPythonè§£é‡Šå™¨é¦–å…ˆä¼šå°è¯•ä»some_dictåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼š

```python
In [182]: dict_iterator = iter(some_dict)

In [183]: dict_iterator
Out[183]: <dict_keyiterator at 0x7fbbd5a9f908>
```

è¿­ä»£å™¨æ˜¯ä¸€ç§ç‰¹æ®Šå¯¹è±¡ï¼Œå®ƒå¯ä»¥åœ¨è¯¸å¦‚forå¾ªç¯ä¹‹ç±»çš„ä¸Šä¸‹æ–‡ä¸­å‘Pythonè§£é‡Šå™¨è¾“é€å¯¹è±¡ã€‚å¤§éƒ¨åˆ†èƒ½æ¥å—åˆ—è¡¨ä¹‹ç±»çš„å¯¹è±¡çš„æ–¹æ³•ä¹Ÿéƒ½å¯ä»¥æ¥å—ä»»ä½•å¯è¿­ä»£å¯¹è±¡ã€‚æ¯”å¦‚minã€maxã€sumç­‰å†…ç½®æ–¹æ³•ä»¥åŠlistã€tupleç­‰ç±»å‹æ„é€ å™¨ï¼š

```python
In [184]: list(dict_iterator)
Out[184]: ['a', 'b', 'c']
```

ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰æ˜¯æ„é€ æ–°çš„å¯è¿­ä»£å¯¹è±¡çš„ä¸€ç§ç®€å•æ–¹å¼ã€‚ä¸€èˆ¬çš„å‡½æ•°æ‰§è¡Œä¹‹ååªä¼šè¿”å›å•ä¸ªå€¼ï¼Œè€Œç”Ÿæˆå™¨åˆ™æ˜¯ä»¥å»¶è¿Ÿçš„æ–¹å¼è¿”å›ä¸€ä¸ªå€¼åºåˆ—ï¼Œå³æ¯è¿”å›ä¸€ä¸ªå€¼ä¹‹åæš‚åœï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªå€¼è¢«è¯·æ±‚æ—¶å†ç»§ç»­ã€‚è¦åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨ï¼Œåªéœ€å°†å‡½æ•°ä¸­çš„returnæ›¿æ¢ä¸ºyeildå³å¯ï¼š

```python
def squares(n=10):
    print('Generating squares from 1 to {0}'.format(n ** 2))
    for i in range(1, n + 1):
        yield i ** 2
```

è°ƒç”¨è¯¥ç”Ÿæˆå™¨æ—¶ï¼Œæ²¡æœ‰ä»»ä½•ä»£ç ä¼šè¢«ç«‹å³æ‰§è¡Œï¼š

```python
In [186]: gen = squares()

In [187]: gen
Out[187]: <generator object squares at 0x7fbbd5ab4570>
```

ç›´åˆ°ä½ ä»è¯¥ç”Ÿæˆå™¨ä¸­è¯·æ±‚å…ƒç´ æ—¶ï¼Œå®ƒæ‰ä¼šå¼€å§‹æ‰§è¡Œå…¶ä»£ç ï¼š
```python
In [188]: for x in gen:
   .....:     print(x, end=' ')
Generating squares from 1 to 100
1 4 9 16 25 36 49 64 81 100
```

## 3.2.7 ç”Ÿæˆå™¨è¡¨è¾¾å¼
å¦ä¸€ç§æ›´ç®€æ´çš„æ„é€ ç”Ÿæˆå™¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ˆgenerator expressionï¼‰ã€‚è¿™æ˜¯ä¸€ç§ç±»ä¼¼äºåˆ—è¡¨ã€å­—å…¸ã€é›†åˆæ¨å¯¼å¼çš„ç”Ÿæˆå™¨ã€‚å…¶åˆ›å»ºæ–¹å¼ä¸ºï¼ŒæŠŠåˆ—è¡¨æ¨å¯¼å¼ä¸¤ç«¯çš„æ–¹æ‹¬å·æ”¹æˆåœ†æ‹¬å·ï¼š

```python
In [189]: gen = (x ** 2 for x in range(100))

In [190]: gen
Out[190]: <generator object <genexpr> at 0x7fbbd5ab29e8>
```

å®ƒè·Ÿä¸‹é¢è¿™ä¸ªå†—é•¿å¾—å¤šçš„ç”Ÿæˆå™¨æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼š

```python
def _make_gen():
    for x in range(100):
        yield x ** 2
gen = _make_gen()
```

ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¹Ÿå¯ä»¥å–ä»£åˆ—è¡¨æ¨å¯¼å¼ï¼Œä½œä¸ºå‡½æ•°å‚æ•°ï¼š
```python
In [191]: sum(x ** 2 for x in range(100))
Out[191]: 328350

In [192]: dict((i, i **2) for i in range(5))
Out[192]: {0: 0, 1: 1, 2: 4, 3: 9, 4: 16}
```

## 3.2.8 itertoolsæ¨¡å—
æ ‡å‡†åº“itertoolsæ¨¡å—ä¸­æœ‰ä¸€ç»„ç”¨äºè®¸å¤šå¸¸è§æ•°æ®ç®—æ³•çš„ç”Ÿæˆå™¨ã€‚ä¾‹å¦‚ï¼Œgroupbyå¯ä»¥æ¥å—ä»»ä½•åºåˆ—å’Œä¸€ä¸ªå‡½æ•°ã€‚å®ƒæ ¹æ®å‡½æ•°çš„è¿”å›å€¼å¯¹åºåˆ—ä¸­çš„è¿ç»­å…ƒç´ è¿›è¡Œåˆ†ç»„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```python
In [193]: import itertools

In [194]: first_letter = lambda x: x[0]

In [195]: names = ['Alan', 'Adam', 'Wes', 'Will', 'Albert', 'Steven']

In [196]: for letter, names in itertools.groupby(names, first_letter):
   .....:     print(letter, list(names)) # names is a generator
A ['Alan', 'Adam']
W ['Wes', 'Will']
A ['Albert']
S ['Steven']
```

è¡¨3-2ä¸­åˆ—å‡ºäº†ä¸€äº›æˆ‘ç»å¸¸ç”¨åˆ°çš„itertoolså‡½æ•°ã€‚å»ºè®®å‚é˜…Pythonå®˜æ–¹æ–‡æ¡£ï¼Œè¿›ä¸€æ­¥å­¦ä¹ ã€‚

![è¡¨3-2 ä¸€äº›æœ‰ç”¨çš„itertoolså‡½æ•°](https://gitee.com/wugenqiang/images/raw/master/01/1240-20201009185536362.png)

## 3.2.9 é”™è¯¯å’Œå¼‚å¸¸å¤„ç†
ä¼˜é›…åœ°å¤„ç†Pythonçš„é”™è¯¯å’Œå¼‚å¸¸æ˜¯æ„å»ºå¥å£®ç¨‹åºçš„é‡è¦éƒ¨åˆ†ã€‚åœ¨æ•°æ®åˆ†æä¸­ï¼Œè®¸å¤šå‡½æ•°å‡½æ•°åªç”¨äºéƒ¨åˆ†è¾“å…¥ã€‚ä¾‹å¦‚ï¼ŒPythonçš„floatå‡½æ•°å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢æˆæµ®ç‚¹æ•°ï¼Œä½†è¾“å…¥æœ‰è¯¯æ—¶ï¼Œæœ‰``ValueError``é”™è¯¯ï¼š

```python
In [197]: float('1.2345')
Out[197]: 1.2345

In [198]: float('something')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-198-439904410854> in <module>()
----> 1 float('something')
ValueError: could not convert string to float: 'something'
```

å‡å¦‚æƒ³ä¼˜é›…åœ°å¤„ç†floatçš„é”™è¯¯ï¼Œè®©å®ƒè¿”å›è¾“å…¥å€¼ã€‚æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨try/exceptä¸­è°ƒç”¨floatï¼š

```python
def attempt_float(x):
    try:
        return float(x)
    except:
        return x
```

å½“float(x)æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œexceptçš„éƒ¨åˆ†ï¼š

```python
In [200]: attempt_float('1.2345')
Out[200]: 1.2345

In [201]: attempt_float('something')
Out[201]: 'something'
```

ä½ å¯èƒ½æ³¨æ„åˆ°floatæŠ›å‡ºçš„å¼‚å¸¸ä¸ä»…æ˜¯ValueErrorï¼š

```python
In [202]: float((1, 2))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-202-842079ebb635> in <module>()
----> 1 float((1, 2))
TypeError: float() argument must be a string or a number, not 'tuple'
```

ä½ å¯èƒ½åªæƒ³å¤„ç†ValueErrorï¼ŒTypeErroré”™è¯¯ï¼ˆè¾“å…¥ä¸æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å€¼ï¼‰å¯èƒ½æ˜¯åˆç†çš„bugã€‚å¯ä»¥å†™ä¸€ä¸ªå¼‚å¸¸ç±»å‹ï¼š

```python
def attempt_float(x):
    try:
        return float(x)
    except ValueError:
        return x
```

ç„¶åæœ‰ï¼š

```python
In [204]: attempt_float((1, 2))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-204-9bdfd730cead> in <module>()
----> 1 attempt_float((1, 2))
<ipython-input-203-3e06b8379b6b> in attempt_float(x)
      1 def attempt_float(x):
      2     try:
----> 3         return float(x)
      4     except ValueError:
      5         return x
TypeError: float() argument must be a string or a number, not 'tuple'
```

å¯ä»¥ç”¨å…ƒç»„åŒ…å«å¤šä¸ªå¼‚å¸¸ï¼š

```python
def attempt_float(x):
    try:
        return float(x)
    except (TypeError, ValueError):
        return x
```

æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸æƒ³æŠ‘åˆ¶å¼‚å¸¸ï¼Œä½ æƒ³æ— è®ºtryéƒ¨åˆ†çš„ä»£ç æ˜¯å¦æˆåŠŸï¼Œéƒ½æ‰§è¡Œä¸€æ®µä»£ç ã€‚å¯ä»¥ä½¿ç”¨finallyï¼š

```python
f = open(path, 'w')

try:
    write_to_file(f)
finally:
    f.close()
```

è¿™é‡Œï¼Œæ–‡ä»¶å¤„ç†fæ€»ä¼šè¢«å…³é—­ã€‚ç›¸ä¼¼çš„ï¼Œä½ å¯ä»¥ç”¨elseè®©åªåœ¨tryéƒ¨åˆ†æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œæ‰æ‰§è¡Œä»£ç ï¼š

```python
f = open(path, 'w')

try:
    write_to_file(f)
except:
    print('Failed')
else:
    print('Succeeded')
finally:
    f.close()
```

## 3.2.10 IPythonçš„å¼‚å¸¸
å¦‚æœæ˜¯åœ¨%runä¸€ä¸ªè„šæœ¬æˆ–ä¸€æ¡è¯­å¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼ŒIPythoné»˜è®¤ä¼šæ‰“å°å®Œæ•´çš„è°ƒç”¨æ ˆï¼ˆtracebackï¼‰ï¼Œåœ¨æ ˆçš„æ¯ä¸ªç‚¹éƒ½ä¼šæœ‰å‡ è¡Œä¸Šä¸‹æ–‡ï¼š

```python
In [10]: %run examples/ipython_bug.py
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
/home/wesm/code/pydata-book/examples/ipython_bug.py in <module>()
     13     throws_an_exception()
     14
---> 15 calling_things()

/home/wesm/code/pydata-book/examples/ipython_bug.py in calling_things()
     11 def calling_things():
     12     works_fine()
---> 13     throws_an_exception()
     14
     15 calling_things()

/home/wesm/code/pydata-book/examples/ipython_bug.py in throws_an_exception()
      7     a = 5
      8     b = 6
----> 9     assert(a + b == 10)
     10
     11 def calling_things():

AssertionError:
```

è‡ªèº«å°±å¸¦æœ‰æ–‡æœ¬æ˜¯ç›¸å¯¹äºPythonæ ‡å‡†è§£é‡Šå™¨çš„æå¤§ä¼˜ç‚¹ã€‚ä½ å¯ä»¥ç”¨é­”æœ¯å‘½ä»¤``%xmode``ï¼Œä»Plainï¼ˆä¸Pythonæ ‡å‡†è§£é‡Šå™¨ç›¸åŒï¼‰åˆ°Verboseï¼ˆå¸¦æœ‰å‡½æ•°çš„å‚æ•°å€¼ï¼‰æ§åˆ¶æ–‡æœ¬æ˜¾ç¤ºçš„æ•°é‡ã€‚åé¢å¯ä»¥çœ‹åˆ°ï¼Œå‘ç”Ÿé”™è¯¯ä¹‹åï¼Œï¼ˆç”¨%debugæˆ–%pdb magicsï¼‰å¯ä»¥è¿›å…¥stackè¿›è¡Œäº‹åè°ƒè¯•ã€‚

# 3.3 æ–‡ä»¶å’Œæ“ä½œç³»ç»Ÿ
æœ¬ä¹¦çš„ä»£ç ç¤ºä¾‹å¤§å¤šä½¿ç”¨è¯¸å¦‚pandas.read_csvä¹‹ç±»çš„é«˜çº§å·¥å…·å°†ç£ç›˜ä¸Šçš„æ•°æ®æ–‡ä»¶è¯»å…¥Pythonæ•°æ®ç»“æ„ã€‚ä½†æˆ‘ä»¬è¿˜æ˜¯éœ€è¦äº†è§£ä¸€äº›æœ‰å…³Pythonæ–‡ä»¶å¤„ç†æ–¹é¢çš„åŸºç¡€çŸ¥è¯†ã€‚å¥½åœ¨å®ƒæœ¬æ¥å°±å¾ˆç®€å•ï¼Œè¿™ä¹Ÿæ˜¯Pythonåœ¨æ–‡æœ¬å’Œæ–‡ä»¶å¤„ç†æ–¹é¢çš„å¦‚æ­¤æµè¡Œçš„åŸå› ä¹‹ä¸€ã€‚

ä¸ºäº†æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ä»¥ä¾¿è¯»å†™ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„openå‡½æ•°ä»¥åŠä¸€ä¸ªç›¸å¯¹æˆ–ç»å¯¹çš„æ–‡ä»¶è·¯å¾„ï¼š

```python
In [207]: path = 'examples/segismundo.txt'

In [208]: f = open(path)
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡ä»¶æ˜¯ä»¥åªè¯»æ¨¡å¼ï¼ˆ'r'ï¼‰æ‰“å¼€çš„ã€‚ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒå¤„ç†åˆ—è¡¨é‚£æ ·æ¥å¤„ç†è¿™ä¸ªæ–‡ä»¶å¥æŸ„fäº†ï¼Œæ¯”å¦‚å¯¹è¡Œè¿›è¡Œè¿­ä»£ï¼š

```python
for line in f:
    pass
```

ä»æ–‡ä»¶ä¸­å–å‡ºçš„è¡Œéƒ½å¸¦æœ‰å®Œæ•´çš„è¡Œç»“æŸç¬¦ï¼ˆEOLï¼‰ï¼Œå› æ­¤ä½ å¸¸å¸¸ä¼šçœ‹åˆ°ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼ˆå¾—åˆ°ä¸€ç»„æ²¡æœ‰EOLçš„è¡Œï¼‰ï¼š

```python
In [209]: lines = [x.rstrip() for x in open(path)]

In [210]: lines
Out[210]: 
['SueÃ±a el rico en su riqueza,',
 'que mÃ¡s cuidados le ofrece;',
 '',
 'sueÃ±a el pobre que padece',
 'su miseria y su pobreza;',
 '',
 'sueÃ±a el que a medrar empieza,',
 'sueÃ±a el que afana y pretende,',
 'sueÃ±a el que agravia y ofende,',
 '',
 'y en el mundo, en conclusiÃ³n,',
 'todos sueÃ±an lo que son,',
 'aunque ninguno lo entiende.',
 '']
```

å¦‚æœä½¿ç”¨openåˆ›å»ºæ–‡ä»¶å¯¹è±¡ï¼Œä¸€å®šè¦ç”¨closeå…³é—­å®ƒã€‚å…³é—­æ–‡ä»¶å¯ä»¥è¿”å›æ“ä½œç³»ç»Ÿèµ„æºï¼š

```python
In [211]: f.close()
```

ç”¨withè¯­å¥å¯ä»¥å¯ä»¥æ›´å®¹æ˜“åœ°æ¸…ç†æ‰“å¼€çš„æ–‡ä»¶ï¼š
```python
In [212]: with open(path) as f:
   .....:     lines = [x.rstrip() for x in f]
```

è¿™æ ·å¯ä»¥åœ¨é€€å‡ºä»£ç å—æ—¶ï¼Œè‡ªåŠ¨å…³é—­æ–‡ä»¶ã€‚

å¦‚æœè¾“å…¥f =open(path,'w')ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªæ–°æ–‡ä»¶è¢«åˆ›å»ºåœ¨examples/segismundo.txtï¼Œå¹¶è¦†ç›–æ‰è¯¥ä½ç½®åŸæ¥çš„ä»»ä½•æ•°æ®ã€‚å¦å¤–æœ‰ä¸€ä¸ªxæ–‡ä»¶æ¨¡å¼ï¼Œå®ƒå¯ä»¥åˆ›å»ºå¯å†™çš„æ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œå°±æ— æ³•åˆ›å»ºã€‚è¡¨3-3åˆ—å‡ºäº†æ‰€æœ‰çš„è¯»/å†™æ¨¡å¼ã€‚

![è¡¨3-3 Pythonçš„æ–‡ä»¶æ¨¡å¼](https://gitee.com/wugenqiang/images/raw/master/01/1240-20201009185850741.png)

å¯¹äºå¯è¯»æ–‡ä»¶ï¼Œä¸€äº›å¸¸ç”¨çš„æ–¹æ³•æ˜¯readã€seekå’Œtellã€‚readä¼šä»æ–‡ä»¶è¿”å›å­—ç¬¦ã€‚å­—ç¬¦çš„å†…å®¹æ˜¯ç”±æ–‡ä»¶çš„ç¼–ç å†³å®šçš„ï¼ˆå¦‚UTF-8ï¼‰ï¼Œå¦‚æœæ˜¯äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€çš„å°±æ˜¯åŸå§‹å­—èŠ‚ï¼š

```python
In [213]: f = open(path)

In [214]: f.read(10)
Out[214]: 'SueÃ±a el r'

In [215]: f2 = open(path, 'rb')  # Binary mode

In [216]: f2.read(10)
Out[216]: b'Sue\xc3\xb1a el '
```

readæ¨¡å¼ä¼šå°†æ–‡ä»¶å¥æŸ„çš„ä½ç½®æå‰ï¼Œæå‰çš„æ•°é‡æ˜¯è¯»å–çš„å­—èŠ‚æ•°ã€‚tellå¯ä»¥ç»™å‡ºå½“å‰çš„ä½ç½®ï¼š

```python
In [217]: f.tell()
Out[217]: 11

In [218]: f2.tell()
Out[218]: 10
```

å°½ç®¡æˆ‘ä»¬ä»æ–‡ä»¶è¯»å–äº†10ä¸ªå­—ç¬¦ï¼Œä½ç½®å´æ˜¯11ï¼Œè¿™æ˜¯å› ä¸ºç”¨é»˜è®¤çš„ç¼–ç ç”¨äº†è¿™ä¹ˆå¤šå­—èŠ‚æ‰è§£ç äº†è¿™10ä¸ªå­—ç¬¦ã€‚ä½ å¯ä»¥ç”¨sysæ¨¡å—æ£€æŸ¥é»˜è®¤çš„ç¼–ç ï¼š

```python
In [219]: import sys

In [220]: sys.getdefaultencoding()
Out[220]: 'utf-8'
```

seekå°†æ–‡ä»¶ä½ç½®æ›´æ”¹ä¸ºæ–‡ä»¶ä¸­çš„æŒ‡å®šå­—èŠ‚ï¼š

```python
In [221]: f.seek(3)
Out[221]: 3

In [222]: f.read(1)
Out[222]: 'Ã±'
```

æœ€åï¼Œå…³é—­æ–‡ä»¶ï¼š

```python
In [223]: f.close()

In [224]: f2.close()
```

å‘æ–‡ä»¶å†™å…¥ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶çš„writeæˆ–writelinesæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ— ç©ºè¡Œç‰ˆçš„prof_mod.pyï¼š

```python
In [225]: with open('tmp.txt', 'w') as handle:
   .....:     handle.writelines(x for x in open(path) if len(x) > 1)

In [226]: with open('tmp.txt') as f:
   .....:     lines = f.readlines()

In [227]: lines
Out[227]: 
['SueÃ±a el rico en su riqueza,\n',
 'que mÃ¡s cuidados le ofrece;\n',
 'sueÃ±a el pobre que padece\n',
 'su miseria y su pobreza;\n',
 'sueÃ±a el que a medrar empieza,\n',
 'sueÃ±a el que afana y pretende,\n',
 'sueÃ±a el que agravia y ofende,\n',
 'y en el mundo, en conclusiÃ³n,\n',
 'todos sueÃ±an lo que son,\n',
 'aunque ninguno lo entiende.\n']
```

è¡¨3-4åˆ—å‡ºäº†ä¸€äº›æœ€å¸¸ç”¨çš„æ–‡ä»¶æ–¹æ³•ã€‚

![è¡¨3-4 Pythoné‡è¦çš„æ–‡ä»¶æ–¹æ³•æˆ–å±æ€§](https://gitee.com/wugenqiang/images/raw/master/01/1240-20201009185922864.png)

## 3.3.1 æ–‡ä»¶çš„å­—èŠ‚å’ŒUnicode
Pythonæ–‡ä»¶çš„é»˜è®¤æ“ä½œæ˜¯â€œæ–‡æœ¬æ¨¡å¼â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ éœ€è¦å¤„ç†Pythonçš„å­—ç¬¦ä¸²ï¼ˆå³Unicodeï¼‰ã€‚å®ƒä¸â€œäºŒè¿›åˆ¶æ¨¡å¼â€ç›¸å¯¹ï¼Œæ–‡ä»¶æ¨¡å¼åŠ ä¸€ä¸ªbã€‚æˆ‘ä»¬æ¥çœ‹ä¸Šä¸€èŠ‚çš„æ–‡ä»¶ï¼ˆUTF-8ç¼–ç ã€åŒ…å«éASCIIå­—ç¬¦ï¼‰ï¼š

```python
In [230]: with open(path) as f:
   .....:     chars = f.read(10)

In [231]: chars
Out[231]: 'SueÃ±a el r'
```

UTF-8æ˜¯é•¿åº¦å¯å˜çš„Unicodeç¼–ç ï¼Œæ‰€ä»¥å½“æˆ‘ä»æ–‡ä»¶è¯·æ±‚ä¸€å®šæ•°é‡çš„å­—ç¬¦æ—¶ï¼ŒPythonä¼šä»æ–‡ä»¶è¯»å–è¶³å¤Ÿå¤šï¼ˆå¯èƒ½å°‘è‡³10æˆ–å¤šè‡³40å­—èŠ‚ï¼‰çš„å­—èŠ‚è¿›è¡Œè§£ç ã€‚å¦‚æœä»¥â€œrbâ€æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œåˆ™è¯»å–ç¡®åˆ‡çš„è¯·æ±‚å­—èŠ‚æ•°ï¼š

```python
In [232]: with open(path, 'rb') as f:
   .....:     data = f.read(10)

In [233]: data
Out[233]: b'Sue\xc3\xb1a el '
```

å–å†³äºæ–‡æœ¬çš„ç¼–ç ï¼Œä½ å¯ä»¥å°†å­—èŠ‚è§£ç ä¸ºstrå¯¹è±¡ï¼Œä½†åªæœ‰å½“æ¯ä¸ªç¼–ç çš„Unicodeå­—ç¬¦éƒ½å®Œå…¨æˆå½¢æ—¶æ‰èƒ½è¿™ä¹ˆåšï¼š

```python
In [234]: data.decode('utf8')
Out[234]: 'SueÃ±a el '

In [235]: data[:4].decode('utf8')
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
<ipython-input-235-300e0af10bb7> in <module>()
----> 1 data[:4].decode('utf8')
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xc3 in position 3: unexpecte
d end of data
```

æ–‡æœ¬æ¨¡å¼ç»“åˆäº†opençš„ç¼–ç é€‰é¡¹ï¼Œæä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿çš„æ–¹æ³•å°†Unicodeè½¬æ¢ä¸ºå¦ä¸€ç§ç¼–ç ï¼š

```python
In [236]: sink_path = 'sink.txt'

In [237]: with open(path) as source:
   .....:     with open(sink_path, 'xt', encoding='iso-8859-1') as sink:
   .....:         sink.write(source.read())

In [238]: with open(sink_path, encoding='iso-8859-1') as f:
   .....:     print(f.read(10))
SueÃ±a el r
```

æ³¨æ„ï¼Œä¸è¦åœ¨äºŒè¿›åˆ¶æ¨¡å¼ä¸­ä½¿ç”¨seekã€‚å¦‚æœæ–‡ä»¶ä½ç½®ä½äºå®šä¹‰Unicodeå­—ç¬¦çš„å­—èŠ‚çš„ä¸­é—´ä½ç½®ï¼Œè¯»å–åé¢ä¼šäº§ç”Ÿé”™è¯¯ï¼š

```python
In [240]: f = open(path)

In [241]: f.read(5)
Out[241]: 'SueÃ±a'

In [242]: f.seek(4)
Out[242]: 4

In [243]: f.read(1)
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
<ipython-input-243-7841103e33f5> in <module>()
----> 1 f.read(1)
/miniconda/envs/book-env/lib/python3.6/codecs.py in decode(self, input, final)
    319         # decode input (taking the buffer into account)
    320         data = self.buffer + input
--> 321         (result, consumed) = self._buffer_decode(data, self.errors, final
)
    322         # keep undecoded input until the next call
    323         self.buffer = data[consumed:]
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xb1 in position 0: invalid s
tart byte

In [244]: f.close()
```

å¦‚æœä½ ç»å¸¸è¦å¯¹éASCIIå­—ç¬¦æ–‡æœ¬è¿›è¡Œæ•°æ®åˆ†æï¼Œé€šæ™“Pythonçš„UnicodeåŠŸèƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚æ›´å¤šå†…å®¹ï¼Œå‚é˜…Pythonå®˜æ–¹æ–‡æ¡£ã€‚

# 3.4 ç»“è®º
æˆ‘ä»¬å·²ç»å­¦è¿‡äº†Pythonçš„åŸºç¡€ã€ç¯å¢ƒå’Œè¯­æ³•ï¼Œæ¥ä¸‹æ¥å­¦ä¹ NumPyå’ŒPythonçš„é¢å‘æ•°ç»„è®¡ç®—ã€‚

