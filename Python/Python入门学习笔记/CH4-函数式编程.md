# ç¬¬å››ç«  å‡½æ•°å¼ç¼–ç¨‹

å‡½æ•°æ˜¯ Python å†…å»ºæ”¯æŒçš„ä¸€ç§å°è£…ï¼Œæˆ‘ä»¬é€šè¿‡æŠŠå¤§æ®µä»£ç æ‹†æˆå‡½æ•°ï¼Œé€šè¿‡ä¸€å±‚ä¸€å±‚çš„å‡½æ•°è°ƒç”¨ï¼Œå°±å¯ä»¥æŠŠå¤æ‚ä»»åŠ¡åˆ†è§£æˆç®€å•çš„ä»»åŠ¡ï¼Œè¿™ç§åˆ†è§£å¯ä»¥ç§°ä¹‹ä¸ºé¢å‘è¿‡ç¨‹çš„ç¨‹åºè®¾è®¡ã€‚å‡½æ•°å°±æ˜¯é¢å‘è¿‡ç¨‹çš„ç¨‹åºè®¾è®¡çš„åŸºæœ¬å•å…ƒã€‚

è€Œå‡½æ•°å¼ç¼–ç¨‹ï¼ˆè¯·æ³¨æ„å¤šäº†ä¸€ä¸ªâ€œå¼â€å­—ï¼‰â€”â€” Functional Programmingï¼Œè™½ç„¶ä¹Ÿå¯ä»¥å½’ç»“åˆ°é¢å‘è¿‡ç¨‹çš„ç¨‹åºè®¾è®¡ï¼Œä½†å…¶æ€æƒ³æ›´æ¥è¿‘æ•°å­¦è®¡ç®—ã€‚

æˆ‘ä»¬é¦–å…ˆè¦ææ˜ç™½è®¡ç®—æœºï¼ˆComputerï¼‰å’Œè®¡ç®—ï¼ˆComputeï¼‰çš„æ¦‚å¿µã€‚

åœ¨è®¡ç®—æœºçš„å±‚æ¬¡ä¸Šï¼ŒCPU æ‰§è¡Œçš„æ˜¯åŠ å‡ä¹˜é™¤çš„`æŒ‡ä»¤ä»£ç `ï¼Œä»¥åŠå„ç§æ¡ä»¶åˆ¤æ–­å’Œè·³è½¬æŒ‡ä»¤ï¼Œæ‰€ä»¥ï¼Œæ±‡ç¼–è¯­è¨€æ˜¯æœ€è´´è¿‘è®¡ç®—æœºçš„è¯­è¨€ã€‚

è€Œè®¡ç®—åˆ™æŒ‡æ•°å­¦æ„ä¹‰ä¸Šçš„è®¡ç®—ï¼Œè¶Šæ˜¯æŠ½è±¡çš„è®¡ç®—ï¼Œç¦»è®¡ç®—æœºç¡¬ä»¶è¶Šè¿œã€‚

å¯¹åº”åˆ°ç¼–ç¨‹è¯­è¨€ï¼Œå°±æ˜¯è¶Šä½çº§çš„è¯­è¨€ï¼Œè¶Šè´´è¿‘è®¡ç®—æœºï¼ŒæŠ½è±¡ç¨‹åº¦ä½ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ï¼Œæ¯”å¦‚ C è¯­è¨€ï¼›è¶Šé«˜çº§çš„è¯­è¨€ï¼Œè¶Šè´´è¿‘è®¡ç®—ï¼ŒæŠ½è±¡ç¨‹åº¦é«˜ï¼Œæ‰§è¡Œæ•ˆç‡ä½ï¼Œæ¯”å¦‚ Lisp è¯­è¨€ã€‚

> ğŸğŸ‰ è¯ç”Ÿ 50 å¤šå¹´ä¹‹åï¼Œ[å‡½æ•°å¼ç¼–ç¨‹](http://en.wikipedia.org/wiki/Functional_programming)ï¼ˆfunctional programmingï¼‰å¼€å§‹è·å¾—è¶Šæ¥è¶Šå¤šçš„å…³æ³¨ã€‚ä¸ä»…æœ€å¤è€çš„å‡½æ•°å¼è¯­è¨€ Lisp é‡è·é’æ˜¥ï¼Œè€Œä¸”æ–°çš„å‡½æ•°å¼è¯­è¨€å±‚å‡ºä¸ç©·ï¼Œæ¯”å¦‚ Erlangã€clojureã€Scalaã€F# ç­‰ç­‰ã€‚ç›®å‰æœ€å½“çº¢çš„ Pythonã€Rubyã€Javascriptï¼Œå¯¹å‡½æ•°å¼ç¼–ç¨‹çš„æ”¯æŒéƒ½å¾ˆå¼ºï¼Œå°±è¿è€ç‰Œçš„é¢å‘å¯¹è±¡çš„ Javaã€é¢å‘è¿‡ç¨‹çš„ PHPï¼Œéƒ½å¿™ä¸è¿­åœ°åŠ å…¥å¯¹åŒ¿åå‡½æ•°çš„æ”¯æŒã€‚è¶Šæ¥è¶Šå¤šçš„è¿¹è±¡è¡¨æ˜ï¼Œå‡½æ•°å¼ç¼–ç¨‹å·²ç»ä¸å†æ˜¯å­¦æœ¯ç•Œçš„æœ€çˆ±ï¼Œå¼€å§‹å¤§è¸æ­¥åœ°åœ¨ä¸šç•ŒæŠ•å…¥å®ç”¨ã€‚ä¹Ÿè®¸ç»§"é¢å‘å¯¹è±¡ç¼–ç¨‹"ä¹‹åï¼Œ"å‡½æ•°å¼ç¼–ç¨‹"ä¼šæˆä¸ºä¸‹ä¸€ä¸ªç¼–ç¨‹çš„ä¸»æµèŒƒå¼ï¼ˆparadigmï¼‰ã€‚

## 4.1 ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹

å‡½æ•°å¼ç¼–ç¨‹å°±æ˜¯ä¸€ç§æŠ½è±¡ç¨‹åº¦å¾ˆé«˜çš„ç¼–ç¨‹èŒƒå¼ï¼Œçº¯ç²¹çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„å‡½æ•°æ²¡æœ‰å˜é‡ï¼Œå› æ­¤ï¼Œä»»æ„ä¸€ä¸ªå‡½æ•°ï¼Œåªè¦è¾“å…¥æ˜¯ç¡®å®šçš„ï¼Œè¾“å‡ºå°±æ˜¯ç¡®å®šçš„ï¼Œè¿™ç§çº¯å‡½æ•°æˆ‘ä»¬ç§°ä¹‹ä¸ºæ²¡æœ‰å‰¯ä½œç”¨ã€‚è€Œå…è®¸ä½¿ç”¨å˜é‡çš„ç¨‹åºè®¾è®¡è¯­è¨€ï¼Œç”±äºå‡½æ•°å†…éƒ¨çš„å˜é‡çŠ¶æ€ä¸ç¡®å®šï¼ŒåŒæ ·çš„è¾“å…¥ï¼Œå¯èƒ½å¾—åˆ°ä¸åŒçš„è¾“å‡ºï¼Œå› æ­¤ï¼Œè¿™ç§å‡½æ•°æ˜¯æœ‰å‰¯ä½œç”¨çš„ã€‚

ğŸ”Š å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼Œå…è®¸æŠŠå‡½æ•°æœ¬èº«ä½œä¸ºå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼Œè¿˜å…è®¸è¿”å›ä¸€ä¸ªå‡½æ•°ï¼

Python å¯¹å‡½æ•°å¼ç¼–ç¨‹æä¾›éƒ¨åˆ†æ”¯æŒã€‚ç”±äº Python å…è®¸ä½¿ç”¨å˜é‡ï¼Œå› æ­¤ï¼ŒPython ä¸æ˜¯çº¯å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ã€‚

### 4.1.1 å®šä¹‰

ç®€å•è¯´ï¼Œ"å‡½æ•°å¼ç¼–ç¨‹"æ˜¯ä¸€ç§["ç¼–ç¨‹èŒƒå¼"](http://en.wikipedia.org/wiki/Programming_paradigm)ï¼ˆprogramming paradigmï¼‰ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•ç¼–å†™ç¨‹åºçš„æ–¹æ³•è®ºã€‚å®ƒå±äº["ç»“æ„åŒ–ç¼–ç¨‹"](http://en.wikipedia.org/wiki/Structured_programming)çš„ä¸€ç§ï¼Œä¸»è¦æ€æƒ³æ˜¯æŠŠè¿ç®—è¿‡ç¨‹å°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°è°ƒç”¨ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼ï¼š

```python
(1 + 2) * 3 - 4
```

ä¼ ç»Ÿçš„è¿‡ç¨‹å¼ç¼–ç¨‹ï¼Œå¯èƒ½è¿™æ ·å†™ï¼š

```
var a = 1 + 2;
var b = a * 3;
var c = b - 4;
```

å‡½æ•°å¼ç¼–ç¨‹è¦æ±‚ä½¿ç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ**è¿ç®—è¿‡ç¨‹**å®šä¹‰ä¸ºä¸åŒçš„å‡½æ•°ï¼Œç„¶åå†™æˆä¸‹é¢è¿™æ ·ï¼š

```
var result = subtract(multiply(add(1,2), 3), 4);
```

è¿™å°±æ˜¯å‡½æ•°å¼ç¼–ç¨‹ã€‚

### 4.1.2 ç‰¹ç‚¹

å‡½æ•°å¼ç¼–ç¨‹å…·æœ‰äº”ä¸ªé²œæ˜çš„ç‰¹ç‚¹ã€‚

#### â‘  å‡½æ•°æ˜¯"ç¬¬ä¸€ç­‰å…¬æ°‘"

æ‰€è°“["ç¬¬ä¸€ç­‰å…¬æ°‘"](http://en.wikipedia.org/wiki/First-class_function)ï¼ˆfirst classï¼‰ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°ä¸å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·ï¼Œå¤„äºå¹³ç­‰åœ°ä½ï¼Œå¯ä»¥èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…ä½œä¸ºåˆ«çš„å‡½æ•°çš„è¿”å›å€¼ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œä¸‹é¢ä»£ç ä¸­çš„ print å˜é‡å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ã€‚

```
var print = function(i){ 
	console.log(i);
};
[1,2,3].forEach(print);
```

#### â‘¡ åªç”¨"è¡¨è¾¾å¼"ï¼Œä¸ç”¨"è¯­å¥"

"è¡¨è¾¾å¼"ï¼ˆexpressionï¼‰æ˜¯ä¸€ä¸ªå•çº¯çš„è¿ç®—è¿‡ç¨‹ï¼Œæ€»æ˜¯æœ‰è¿”å›å€¼ï¼›"è¯­å¥"ï¼ˆstatementï¼‰æ˜¯æ‰§è¡ŒæŸç§æ“ä½œï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚å‡½æ•°å¼ç¼–ç¨‹è¦æ±‚ï¼Œåªä½¿ç”¨è¡¨è¾¾å¼ï¼Œä¸ä½¿ç”¨è¯­å¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯å•çº¯çš„è¿ç®—ï¼Œè€Œä¸”éƒ½æœ‰è¿”å›å€¼ã€‚

åŸå› æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„å¼€å‘åŠ¨æœºï¼Œä¸€å¼€å§‹å°±æ˜¯ä¸ºäº†å¤„ç†è¿ç®—ï¼ˆcomputationï¼‰ï¼Œä¸è€ƒè™‘ç³»ç»Ÿçš„è¯»å†™ï¼ˆI/Oï¼‰ã€‚"è¯­å¥"å±äºå¯¹ç³»ç»Ÿçš„è¯»å†™æ“ä½œï¼Œæ‰€ä»¥å°±è¢«æ’æ–¥åœ¨å¤–ã€‚

å½“ç„¶ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä¸åš I/O æ˜¯ä¸å¯èƒ½çš„ã€‚å› æ­¤ï¼Œç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œå‡½æ•°å¼ç¼–ç¨‹åªè¦æ±‚æŠŠ I/O é™åˆ¶åˆ°æœ€å°ï¼Œä¸è¦æœ‰ä¸å¿…è¦çš„è¯»å†™è¡Œä¸ºï¼Œä¿æŒè®¡ç®—è¿‡ç¨‹çš„å•çº¯æ€§ã€‚

#### â‘¢ æ²¡æœ‰"å‰¯ä½œç”¨"

æ‰€è°“["å‰¯ä½œç”¨"](http://en.wikipedia.org/wiki/Side_effect_(computer_science))ï¼ˆside effectï¼‰ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°å†…éƒ¨ä¸å¤–éƒ¨äº’åŠ¨ï¼ˆæœ€å…¸å‹çš„æƒ…å†µï¼Œå°±æ˜¯ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ï¼‰ï¼Œäº§ç”Ÿè¿ç®—ä»¥å¤–çš„å…¶ä»–ç»“æœã€‚

å‡½æ•°å¼ç¼–ç¨‹å¼ºè°ƒæ²¡æœ‰"å‰¯ä½œç”¨"ï¼Œæ„å‘³ç€å‡½æ•°è¦ä¿æŒç‹¬ç«‹ï¼Œæ‰€æœ‰åŠŸèƒ½å°±æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å€¼ï¼Œæ²¡æœ‰å…¶ä»–è¡Œä¸ºï¼Œå°¤å…¶æ˜¯ä¸å¾—ä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼ã€‚

#### â‘£ ä¸ä¿®æ”¹çŠ¶æ€

ä¸Šä¸€ç‚¹å·²ç»æåˆ°ï¼Œå‡½æ•°å¼ç¼–ç¨‹åªæ˜¯è¿”å›æ–°çš„å€¼ï¼Œä¸ä¿®æ”¹ç³»ç»Ÿå˜é‡ã€‚å› æ­¤ï¼Œä¸ä¿®æ”¹å˜é‡ï¼Œä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹ã€‚

åœ¨å…¶ä»–ç±»å‹çš„è¯­è¨€ä¸­ï¼Œå˜é‡å¾€å¾€ç”¨æ¥ä¿å­˜"çŠ¶æ€"ï¼ˆstateï¼‰ã€‚ä¸ä¿®æ”¹å˜é‡ï¼Œæ„å‘³ç€çŠ¶æ€ä¸èƒ½ä¿å­˜åœ¨å˜é‡ä¸­ã€‚å‡½æ•°å¼ç¼–ç¨‹ä½¿ç”¨å‚æ•°ä¿å­˜çŠ¶æ€ï¼Œæœ€å¥½çš„ä¾‹å­å°±æ˜¯é€’å½’ã€‚ä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªå°†å­—ç¬¦ä¸²é€†åºæ’åˆ—çš„å‡½æ•°ï¼Œå®ƒæ¼”ç¤ºäº†ä¸åŒçš„å‚æ•°å¦‚ä½•å†³å®šäº†è¿ç®—æ‰€å¤„çš„"çŠ¶æ€"ã€‚

```
function reverse(string) {
ã€€ã€€ã€€ã€€if(string.length == 0) {
ã€€ã€€ã€€ã€€ã€€ã€€return string;
ã€€ã€€ã€€ã€€} else {
ã€€ã€€ã€€ã€€ã€€ã€€return reverse(string.substring(1, string.length)) + string.substring(0, 1);
ã€€ã€€ã€€ã€€}
ã€€ã€€}
```

ç”±äºä½¿ç”¨äº†é€’å½’ï¼Œå‡½æ•°å¼è¯­è¨€çš„è¿è¡Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¿™æ˜¯å®ƒé•¿æœŸä¸èƒ½åœ¨ä¸šç•Œæ¨å¹¿çš„ä¸»è¦åŸå› ã€‚

#### â‘¤ å¼•ç”¨é€æ˜

å¼•ç”¨é€æ˜ï¼ˆReferential transparencyï¼‰ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°çš„è¿è¡Œä¸ä¾èµ–äºå¤–éƒ¨å˜é‡æˆ–"çŠ¶æ€"ï¼Œåªä¾èµ–äºè¾“å…¥çš„å‚æ•°ï¼Œä»»ä½•æ—¶å€™åªè¦å‚æ•°ç›¸åŒï¼Œå¼•ç”¨å‡½æ•°æ‰€å¾—åˆ°çš„è¿”å›å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚

æœ‰äº†å‰é¢çš„ç¬¬ä¸‰ç‚¹å’Œç¬¬å››ç‚¹ï¼Œè¿™ç‚¹æ˜¯å¾ˆæ˜¾ç„¶çš„ã€‚å…¶ä»–ç±»å‹çš„è¯­è¨€ï¼Œå‡½æ•°çš„è¿”å›å€¼å¾€å¾€ä¸ç³»ç»ŸçŠ¶æ€æœ‰å…³ï¼Œä¸åŒçš„çŠ¶æ€ä¹‹ä¸‹ï¼Œè¿”å›å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™å°±å«"å¼•ç”¨ä¸é€æ˜"ï¼Œå¾ˆä¸åˆ©äºè§‚å¯Ÿå’Œç†è§£ç¨‹åºçš„è¡Œä¸ºã€‚

### 4.1.3 å¥½å¤„

å‡½æ•°å¼ç¼–ç¨‹åˆ°åº•æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆä¼šå˜å¾—è¶Šæ¥è¶Šæµè¡Œï¼Ÿ

#### â‘  ä»£ç ç®€æ´ï¼Œå¼€å‘å¿«é€Ÿ

å‡½æ•°å¼ç¼–ç¨‹å¤§é‡ä½¿ç”¨å‡½æ•°ï¼Œå‡å°‘äº†ä»£ç çš„é‡å¤ï¼Œå› æ­¤ç¨‹åºæ¯”è¾ƒçŸ­ï¼Œå¼€å‘é€Ÿåº¦è¾ƒå¿«ã€‚

#### â‘¡ æ¥è¿‘è‡ªç„¶è¯­è¨€ï¼Œæ˜“äºç†è§£

å‡½æ•°å¼ç¼–ç¨‹çš„è‡ªç”±åº¦å¾ˆé«˜ï¼Œå¯ä»¥å†™å‡ºå¾ˆæ¥è¿‘è‡ªç„¶è¯­è¨€çš„ä»£ç ã€‚

å‰æ–‡æ›¾ç»å°†è¡¨è¾¾å¼ (1 + 2) * 3 - 4ï¼Œå†™æˆå‡½æ•°å¼è¯­è¨€ï¼š

```
subtract(multiply(add(1,2), 3), 4)
```

å¯¹å®ƒè¿›è¡Œå˜å½¢ï¼Œä¸éš¾å¾—åˆ°å¦ä¸€ç§å†™æ³•ï¼š

```
add(1,2).multiply(3).subtract(4)
```

è¿™åŸºæœ¬å°±æ˜¯è‡ªç„¶è¯­è¨€çš„è¡¨è¾¾äº†ã€‚å†çœ‹ä¸‹é¢çš„ä»£ç ï¼Œå¤§å®¶åº”è¯¥ä¸€çœ¼å°±èƒ½æ˜ç™½å®ƒçš„æ„æ€å§ï¼š

```
merge([1,2],[3,4]).sort().search("2")
```

å› æ­¤ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ä»£ç æ›´å®¹æ˜“ç†è§£ã€‚

#### â‘¢ æ›´æ–¹ä¾¿çš„ä»£ç ç®¡ç†

å‡½æ•°å¼ç¼–ç¨‹ä¸ä¾èµ–ã€ä¹Ÿä¸ä¼šæ”¹å˜å¤–ç•Œçš„çŠ¶æ€ï¼Œåªè¦ç»™å®šè¾“å…¥å‚æ•°ï¼Œè¿”å›çš„ç»“æœå¿…å®šç›¸åŒã€‚å› æ­¤ï¼Œæ¯ä¸€ä¸ªå‡½æ•°éƒ½å¯ä»¥è¢«çœ‹åšç‹¬ç«‹å•å…ƒï¼Œå¾ˆæœ‰åˆ©äºè¿›è¡Œå•å…ƒæµ‹è¯•ï¼ˆunit testingï¼‰å’Œé™¤é”™ï¼ˆdebuggingï¼‰ï¼Œä»¥åŠæ¨¡å—åŒ–ç»„åˆã€‚

#### â‘£ æ˜“äº"å¹¶å‘ç¼–ç¨‹"

å‡½æ•°å¼ç¼–ç¨‹ä¸éœ€è¦è€ƒè™‘"æ­»é”"ï¼ˆdeadlockï¼‰ï¼Œå› ä¸ºå®ƒä¸ä¿®æ”¹å˜é‡ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸å­˜åœ¨"é”"çº¿ç¨‹çš„é—®é¢˜ã€‚ä¸å¿…æ‹…å¿ƒä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆæ”¾å¿ƒåœ°æŠŠå·¥ä½œåˆ†æ‘Šåˆ°å¤šä¸ªçº¿ç¨‹ï¼Œéƒ¨ç½²"å¹¶å‘ç¼–ç¨‹"ï¼ˆconcurrencyï¼‰ã€‚

è¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š

```
var s1 = Op1();
var s2 = Op2();
var s3 = concat(s1, s2);
```

ç”±äº s1 å’Œ s2 äº’ä¸å¹²æ‰°ï¼Œä¸ä¼šä¿®æ”¹å˜é‡ï¼Œè°å…ˆæ‰§è¡Œæ˜¯æ— æ‰€è°“çš„ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒåœ°å¢åŠ çº¿ç¨‹ï¼ŒæŠŠå®ƒä»¬åˆ†é…åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸Šå®Œæˆã€‚å…¶ä»–ç±»å‹çš„è¯­è¨€å°±åšä¸åˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸º s1 å¯èƒ½ä¼šä¿®æ”¹ç³»ç»ŸçŠ¶æ€ï¼Œè€Œ s2 å¯èƒ½ä¼šç”¨åˆ°è¿™äº›çŠ¶æ€ï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯ s2 åœ¨ s1 ä¹‹åè¿è¡Œï¼Œè‡ªç„¶ä¹Ÿå°±ä¸èƒ½éƒ¨ç½²åˆ°å…¶ä»–çº¿ç¨‹ä¸Šäº†ã€‚

å¤šæ ¸ CPU æ˜¯å°†æ¥çš„æ½®æµï¼Œæ‰€ä»¥å‡½æ•°å¼ç¼–ç¨‹çš„è¿™ä¸ªç‰¹æ€§éå¸¸é‡è¦ã€‚

#### â‘¤ ä»£ç çš„çƒ­å‡çº§

å‡½æ•°å¼ç¼–ç¨‹æ²¡æœ‰å‰¯ä½œç”¨ï¼Œåªè¦ä¿è¯æ¥å£ä¸å˜ï¼Œå†…éƒ¨å®ç°æ˜¯å¤–éƒ¨æ— å…³çš„ã€‚æ‰€ä»¥ï¼Œå¯ä»¥åœ¨è¿è¡ŒçŠ¶æ€ä¸‹ç›´æ¥å‡çº§ä»£ç ï¼Œä¸éœ€è¦é‡å¯ï¼Œä¹Ÿä¸éœ€è¦åœæœºã€‚[Erlang](http://en.wikipedia.org/wiki/Erlang_(programming_language)) è¯­è¨€æ—©å°±è¯æ˜äº†è¿™ä¸€ç‚¹ï¼Œå®ƒæ˜¯ç‘å…¸çˆ±ç«‹ä¿¡å…¬å¸ä¸ºäº†ç®¡ç†ç”µè¯ç³»ç»Ÿè€Œå¼€å‘çš„ï¼Œç”µè¯ç³»ç»Ÿçš„å‡çº§å½“ç„¶æ˜¯ä¸èƒ½åœæœºçš„ã€‚

> ä¸‹é¢è¿›è¡Œå…·ä½“å‡½æ•°å…·ä½“ç¤ºä¾‹ä»‹ç»ï¼š

## 4.2 é«˜é˜¶å‡½æ•°

é«˜é˜¶å‡½æ•°è‹±æ–‡å« Higher-order functionã€‚ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°ï¼Ÿæˆ‘ä»¬ä»¥å®é™…ä»£ç ä¸ºä¾‹å­ï¼Œä¸€æ­¥ä¸€æ­¥æ·±å…¥æ¦‚å¿µã€‚

**ï¼ˆ1ï¼‰å˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°**

ä»¥ Python å†…ç½®çš„æ±‚ç»å¯¹å€¼çš„å‡½æ•°`abs()`ä¸ºä¾‹ï¼Œè°ƒç”¨è¯¥å‡½æ•°ç”¨ä»¥ä¸‹ä»£ç ï¼š

```python
abs(-10) # 10
```

ä½†æ˜¯ï¼Œå¦‚æœåªå†™`abs`å‘¢ï¼Ÿ

![å‡½æ•°](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717093944.png)

å¯è§ï¼Œ`abs(-10)`æ˜¯å‡½æ•°è°ƒç”¨ï¼Œè€Œ`abs`æ˜¯å‡½æ•°æœ¬èº«ã€‚

è¦è·å¾—å‡½æ•°è°ƒç”¨ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç»“æœèµ‹å€¼ç»™å˜é‡ï¼š

```python
x = abs(-10)
x # 10
```

ä½†æ˜¯ï¼Œå¦‚æœæŠŠå‡½æ•°æœ¬èº«èµ‹å€¼ç»™å˜é‡å‘¢ï¼Ÿ

![image-20200717102554966](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717102556.png)

ç»“è®ºï¼šå‡½æ•°æœ¬èº«ä¹Ÿå¯ä»¥èµ‹å€¼ç»™å˜é‡ï¼Œå³ï¼šå˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°ã€‚

å¦‚æœä¸€ä¸ªå˜é‡æŒ‡å‘äº†ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆï¼Œå¯å¦é€šè¿‡è¯¥å˜é‡æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Ÿç”¨ä»£ç éªŒè¯ä¸€ä¸‹ï¼š

```python
f = abs
f(10) # 10
```

æˆåŠŸï¼è¯´æ˜å˜é‡`f`ç°åœ¨å·²ç»æŒ‡å‘äº†`abs`å‡½æ•°æœ¬èº«ã€‚ç›´æ¥è°ƒç”¨`abs()`å‡½æ•°å’Œè°ƒç”¨å˜é‡`f()`å®Œå…¨ç›¸åŒã€‚

**ï¼ˆ2ï¼‰å‡½æ•°åä¹Ÿæ˜¯å˜é‡**

é‚£ä¹ˆå‡½æ•°åæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå‡½æ•°åå…¶å®å°±æ˜¯æŒ‡å‘å‡½æ•°çš„å˜é‡ï¼å¯¹äº`abs()`è¿™ä¸ªå‡½æ•°ï¼Œå®Œå…¨å¯ä»¥æŠŠå‡½æ•°å`abs`çœ‹æˆå˜é‡ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå¯ä»¥è®¡ç®—ç»å¯¹å€¼çš„å‡½æ•°ï¼

å¦‚æœæŠŠ`abs`æŒ‡å‘å…¶ä»–å¯¹è±¡ï¼Œä¼šæœ‰ä»€ä¹ˆæƒ…å†µå‘ç”Ÿï¼Ÿ

![æŠ¥é”™](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717103810.png)

æŠŠ`abs`æŒ‡å‘`10`åï¼Œå°±æ— æ³•é€šè¿‡`abs(-10)`è°ƒç”¨è¯¥å‡½æ•°äº†ï¼å› ä¸º`abs`è¿™ä¸ªå˜é‡å·²ç»ä¸æŒ‡å‘æ±‚ç»å¯¹å€¼å‡½æ•°è€Œæ˜¯æŒ‡å‘ä¸€ä¸ªæ•´æ•°`10`ï¼

å½“ç„¶å®é™…ä»£ç ç»å¯¹ä¸èƒ½è¿™ä¹ˆå†™ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†è¯´æ˜å‡½æ•°åä¹Ÿæ˜¯å˜é‡ã€‚è¦æ¢å¤`abs`å‡½æ•°ï¼Œè¯·é‡å¯ Python äº¤äº’ç¯å¢ƒã€‚

æ³¨ï¼šç”±äº`abs`å‡½æ•°å®é™…ä¸Šæ˜¯å®šä¹‰åœ¨`import builtins`æ¨¡å—ä¸­çš„ï¼Œæ‰€ä»¥è¦è®©ä¿®æ”¹`abs`å˜é‡çš„æŒ‡å‘åœ¨å…¶å®ƒæ¨¡å—ä¹Ÿç”Ÿæ•ˆï¼Œè¦ç”¨`import builtins; builtins.abs = 10`ã€‚

**ï¼ˆ3ï¼‰ä¼ å…¥å‡½æ•°**

æ—¢ç„¶å˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°èƒ½æ¥æ”¶å˜é‡ï¼Œé‚£ä¹ˆä¸€ä¸ªå‡½æ•°å°±å¯ä»¥æ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ç§å‡½æ•°å°±ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°ã€‚

ä¸€ä¸ªæœ€ç®€å•çš„é«˜é˜¶å‡½æ•°ï¼š

```python
def add(x, y, f):
    return f(x) + f(y)
```

å½“æˆ‘ä»¬è°ƒç”¨`add(-5, 6, abs)`æ—¶ï¼Œå‚æ•°`x`ï¼Œ`y`å’Œ`f`åˆ†åˆ«æ¥æ”¶`-5`ï¼Œ`6`å’Œ`abs`ï¼Œæ ¹æ®å‡½æ•°å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼è®¡ç®—è¿‡ç¨‹ä¸ºï¼š

```
x = -5
y = 6
f = abs
f(x) + f(y) ==> abs(-5) + abs(6) ==> 11
return 11
```

éªŒè¯ä¸€ä¸‹ï¼š

![æ•ˆæœå›¾](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717104540.png)

ğŸ‘• ç¼–å†™é«˜é˜¶å‡½æ•°ï¼Œå°±æ˜¯è®©å‡½æ•°çš„å‚æ•°èƒ½å¤Ÿæ¥æ”¶åˆ«çš„å‡½æ•°ã€‚

> å°ç»“ï¼š

æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¿™æ ·çš„å‡½æ•°ç§°ä¸ºé«˜é˜¶å‡½æ•°ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°±æ˜¯æŒ‡è¿™ç§é«˜åº¦æŠ½è±¡çš„ç¼–ç¨‹èŒƒå¼ã€‚

### 4.2.1 map/reduce

Python å†…å»ºäº†`map()`å’Œ`reduce()`å‡½æ•°ã€‚

å¦‚æœä½ è¯»è¿‡ Google çš„é‚£ç¯‡å¤§åé¼é¼çš„è®ºæ–‡â€œ[MapReduce: Simplified Data Processing on Large Clusters](http://research.google.com/archive/mapreduce.html)â€ï¼Œä½ å°±èƒ½å¤§æ¦‚æ˜ç™½ map/reduce çš„æ¦‚å¿µã€‚

#### â‘  map

æˆ‘ä»¬å…ˆçœ‹ mapã€‚`map()`å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯`Iterable`ï¼Œ`map`å°†ä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨åˆ°åºåˆ—çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶æŠŠç»“æœä½œä¸ºæ–°çš„`Iterator`è¿”å›ã€‚

ä¸¾ä¾‹è¯´æ˜ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•° $ f(x)=x^2$ï¼Œè¦æŠŠè¿™ä¸ªå‡½æ•°ä½œç”¨åœ¨ä¸€ä¸ª list `[1, 2, 3, 4, 5, 6, 7, 8, 9]`ä¸Šï¼Œå°±å¯ä»¥ç”¨`map()`å®ç°å¦‚ä¸‹ï¼š

![image-20200717105308037](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717105309.png)

ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨ Python ä»£ç å®ç°ï¼š

```python
def f(x):
    return x * x
r = map(f, [1, 2, 3, 4, 5, 6, 7, 8, 9])
list(r)
```

![image-20200717105513962](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717105515.png)

`map()`ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`f`ï¼Œå³å‡½æ•°å¯¹è±¡æœ¬èº«ã€‚ç”±äºç»“æœ`r`æ˜¯ä¸€ä¸ª`Iterator`ï¼Œ`Iterator`æ˜¯æƒ°æ€§åºåˆ—ï¼Œå› æ­¤é€šè¿‡`list()`å‡½æ•°è®©å®ƒæŠŠæ•´ä¸ªåºåˆ—éƒ½è®¡ç®—å‡ºæ¥å¹¶è¿”å›ä¸€ä¸ªlistã€‚

ä½ å¯èƒ½ä¼šæƒ³ï¼Œä¸éœ€è¦`map()`å‡½æ•°ï¼Œå†™ä¸€ä¸ªå¾ªç¯ï¼Œä¹Ÿå¯ä»¥è®¡ç®—å‡ºç»“æœï¼š

```python
L = []
for n in [1, 2, 3, 4, 5, 6, 7, 8, 9]:
    L.append(f(n))
print(L)
```

çš„ç¡®å¯ä»¥ï¼Œä½†æ˜¯ï¼Œä»ä¸Šé¢çš„å¾ªç¯ä»£ç ï¼Œèƒ½ä¸€çœ¼çœ‹æ˜ç™½â€œæŠŠ f(x) ä½œç”¨åœ¨ list çš„æ¯ä¸€ä¸ªå…ƒç´ å¹¶æŠŠç»“æœç”Ÿæˆä¸€ä¸ªæ–°çš„  listâ€å—ï¼Ÿ

æ‰€ä»¥ï¼Œ`map()`ä½œä¸ºé«˜é˜¶å‡½æ•°ï¼Œäº‹å®ä¸Šå®ƒæŠŠè¿ç®—è§„åˆ™æŠ½è±¡äº†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸ä½†å¯ä»¥è®¡ç®—ç®€å•çš„ $ f(x)=x^2$ï¼Œè¿˜å¯ä»¥è®¡ç®—ä»»æ„å¤æ‚çš„å‡½æ•°ï¼Œæ¯”å¦‚ï¼ŒæŠŠè¿™ä¸ª list æ‰€æœ‰æ•°å­—è½¬ä¸ºå­—ç¬¦ä¸²ï¼š

```python
list(map(str, [1, 2, 3, 4, 5, 6, 7, 8, 9]))
```

![image-20200717110350309](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717110351.png)

åªéœ€è¦ä¸€è¡Œä»£ç ã€‚

#### â‘¡ reduce

å†çœ‹`reduce`çš„ç”¨æ³•ã€‚`reduce`æŠŠä¸€ä¸ªå‡½æ•°ä½œç”¨åœ¨ä¸€ä¸ªåºåˆ—`[x1, x2, x3, ...]`ä¸Šï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œ`reduce`æŠŠç»“æœç»§ç»­å’Œåºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ åšç´¯ç§¯è®¡ç®—ï¼Œå…¶æ•ˆæœå°±æ˜¯ï¼š

```python
reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)
```

æ¯”æ–¹è¯´å¯¹ä¸€ä¸ªåºåˆ—æ±‚å’Œï¼Œå°±å¯ä»¥ç”¨`reduce`å®ç°ï¼š

```python
from functools import reduce
def add(x, y):
    return x + y
reduce(add, [1, 3, 5, 7, 9]) # 25
```

å½“ç„¶æ±‚å’Œè¿ç®—å¯ä»¥ç›´æ¥ç”¨ Python å†…å»ºå‡½æ•°`sum()`ï¼Œæ²¡å¿…è¦åŠ¨ç”¨`reduce`ã€‚

ä½†æ˜¯å¦‚æœè¦æŠŠåºåˆ—`[1, 3, 5, 7, 9]`å˜æ¢æˆæ•´æ•°`13579`ï¼Œ`reduce`å°±å¯ä»¥æ´¾ä¸Šç”¨åœºï¼š

```python
from functools import reduce
def fn(x, y):
    return x * 10 + y
reduce(fn, [1, 3, 5, 7, 9]) # 13579
```

è¿™ä¸ªä¾‹å­æœ¬èº«æ²¡å¤šå¤§ç”¨å¤„ï¼Œä½†æ˜¯ï¼Œå¦‚æœè€ƒè™‘åˆ°å­—ç¬¦ä¸²`str`ä¹Ÿæ˜¯ä¸€ä¸ªåºåˆ—ï¼Œå¯¹ä¸Šé¢çš„ä¾‹å­ç¨åŠ æ”¹åŠ¨ï¼Œé…åˆ`map()`ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºæŠŠ`str`è½¬æ¢ä¸º`int`çš„å‡½æ•°ï¼š

```python
from functools import reduce
def fn(x, y):
    return x * 10 + y
def char2num(s):
    digits = {'0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9}
    return digits[s]
reduce(fn, map(char2num, '13579')) # 13579
```

æ•´ç†æˆä¸€ä¸ª`str2int`çš„å‡½æ•°å°±æ˜¯ï¼š

```python
from functools import reduce

DIGITS = {'0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9}

def str2int(s):
    def fn(x, y):
        return x * 10 + y
    def char2num(s):
        return DIGITS[s]
    return reduce(fn, map(char2num, s))
```

è¿˜å¯ä»¥ç”¨ lambda å‡½æ•°è¿›ä¸€æ­¥ç®€åŒ–æˆï¼š

```python
from functools import reduce

DIGITS = {'0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9}

def char2num(s):
    return DIGITS[s]

def str2int(s):
    return reduce(lambda x, y: x * 10 + y, map(char2num, s))
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ Python æ²¡æœ‰æä¾›`int()`å‡½æ•°ï¼Œä½ å®Œå…¨å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªæŠŠå­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°çš„å‡½æ•°ï¼Œè€Œä¸”åªéœ€è¦å‡ è¡Œä»£ç ï¼

> ç»ƒä¹ é¢˜ï¼š

ã€ç¬¬ä¸€é¢˜ã€‘åˆ©ç”¨`map()`å‡½æ•°ï¼ŒæŠŠç”¨æˆ·è¾“å…¥çš„ä¸è§„èŒƒçš„è‹±æ–‡åå­—ï¼Œå˜ä¸ºé¦–å­—æ¯å¤§å†™ï¼Œå…¶ä»–å°å†™çš„è§„èŒƒåå­—ã€‚è¾“å…¥ï¼š`['adam', 'LISA', 'barT']`ï¼Œè¾“å‡ºï¼š`['Adam', 'Lisa', 'Bart']`ï¼š

```python
def normalize(name):
    return name[0].upper() + name[1:].lower()
```

æˆ–è€…ä¹ŸæŒºå¥½ï¼š

```python
def normalize(name):
    return name.title()  #title()å‡½æ•° é¦–å­—æ¯å¤§å†™  å…¶ä»–å­—æ¯å°å†™
```

æˆ–è€…ä¹ŸæŒºå¥½ï¼š

```python
def normalize(name):
    return name.capitalize()
```

æµ‹è¯•ï¼š

```python
# æµ‹è¯•:
L1 = ['adam', 'LISA', 'barT']
L2 = list(map(normalize, L1))
print(L2)
```

ã€ç¬¬äºŒé¢˜ã€‘Python æä¾›çš„`sum()`å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ª list å¹¶æ±‚å’Œï¼Œè¯·ç¼–å†™ä¸€ä¸ª`prod()`å‡½æ•°ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ª list å¹¶åˆ©ç”¨`reduce()`æ±‚ç§¯ï¼š

```python
from functools import reduce
def prod(L):
    return reduce(lambda x, y: x * y, L)
```

æµ‹è¯•ï¼š

```python
print('3 * 5 * 7 * 9 =', prod([3, 5, 7, 9]))
if prod([3, 5, 7, 9]) == 945:
    print('æµ‹è¯•æˆåŠŸ!')
else:
    print('æµ‹è¯•å¤±è´¥!')
```

ã€ç¬¬ä¸‰é¢˜ã€‘åˆ©ç”¨`map`å’Œ`reduce`ç¼–å†™ä¸€ä¸ª`str2float`å‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸²`'123.456'`è½¬æ¢æˆæµ®ç‚¹æ•°`123.456`ï¼š

æ³•ä¸€ï¼š

```python
from functools import reduce

def str2float(s):
    digits = {'0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9}    
    def char2num(c):
        return digits[c]
    def fn(x, y):
        return x * 10 + y
    pos = s.find('.')
    if pos >= 0:
        return (reduce(fn, map(char2num, s[:pos])) + reduce(fn, map(char2num, s[pos + 1:])) * (10 ** -len(s[pos + 1:]))) 
    return reduce(fn, map(char2num, s))
```

æ³•äºŒï¼š

```python
from functools import reduce

DIGITS = {'0':0, '1':1, '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9}

def str2float(s):   
    
    def str2num(s):
        return DIGITS[s]
    def fn(x, y):
        return x * 10 + y
    if '.' in s:
        nPos = s.find('.')
        s1 = s[:nPos]
        s2 = s[nPos+1:]
        n1 = reduce(fn, map(str2num, s1))
        n2 = reduce(fn, map(str2num, s2))
        return n1 + 0.1 ** len(s2) * n2
    else:
        return ruduce(fn, map(str2num, s))
```



æµ‹è¯•ï¼š

```python
print('str2float(\'123.456\') =', str2float('123.456'))
if abs(str2float('123.456') - 123.456) < 0.00001:
    print('æµ‹è¯•æˆåŠŸ!')
else:
    print('æµ‹è¯•å¤±è´¥!')
```

### 4.2.2 filter

Python å†…å»ºçš„`filter()`å‡½æ•°ç”¨äºè¿‡æ»¤åºåˆ—ã€‚

å’Œ`map()`ç±»ä¼¼ï¼Œ`filter()`ä¹Ÿæ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªåºåˆ—ã€‚å’Œ`map()`ä¸åŒçš„æ˜¯ï¼Œ`filter()`æŠŠä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨äºæ¯ä¸ªå…ƒç´ ï¼Œç„¶åæ ¹æ®è¿”å›å€¼æ˜¯`True`è¿˜æ˜¯`False`å†³å®šä¿ç•™è¿˜æ˜¯ä¸¢å¼ƒè¯¥å…ƒç´ ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª list ä¸­ï¼Œåˆ æ‰å¶æ•°ï¼Œåªä¿ç•™å¥‡æ•°ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```python
def is_odd(n):
    return n % 2 == 1

list(filter(is_odd, [1, 2, 4, 5, 6, 9, 10, 15]))
# ç»“æœ: [1, 5, 9, 15]
```

æŠŠä¸€ä¸ªåºåˆ—ä¸­çš„ç©ºå­—ç¬¦ä¸²åˆ æ‰ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```python
def not_empty(s):
    return s and s.strip()

list(filter(not_empty, ['A', '', 'B', None, 'C', '  ']))
# ç»“æœ: ['A', 'B', 'C']
```

å¯è§ç”¨`filter()`è¿™ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå…³é”®åœ¨äºæ­£ç¡®å®ç°ä¸€ä¸ªâ€œç­›é€‰â€å‡½æ•°ã€‚

æ³¨æ„åˆ°`filter()`å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª`Iterator`ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæƒ°æ€§åºåˆ—ï¼Œæ‰€ä»¥è¦å¼ºè¿«`filter()`å®Œæˆè®¡ç®—ç»“æœï¼Œéœ€è¦ç”¨`list()`å‡½æ•°è·å¾—æ‰€æœ‰ç»“æœå¹¶è¿”å›listã€‚

#### â‘  ç”¨ filter æ±‚ç´ æ•°

è®¡ç®—[ç´ æ•°](http://baike.baidu.com/view/10626.htm)çš„ä¸€ä¸ªæ–¹æ³•æ˜¯[åŸƒæ°ç­›æ³•](http://baike.baidu.com/view/3784258.htm)ï¼Œå®ƒçš„ç®—æ³•ç†è§£èµ·æ¥éå¸¸ç®€å•ï¼š

é¦–å…ˆï¼Œåˆ—å‡ºä»`2`å¼€å§‹çš„æ‰€æœ‰è‡ªç„¶æ•°ï¼Œæ„é€ ä¸€ä¸ªåºåˆ—ï¼š

2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...

å–åºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°`2`ï¼Œå®ƒä¸€å®šæ˜¯ç´ æ•°ï¼Œç„¶åç”¨`2`æŠŠåºåˆ—çš„`2`çš„å€æ•°ç­›æ‰ï¼š

3, ~~4~~, 5, ~~6~~, 7, ~~8~~, 9, ~~10~~, 11, ~~12~~, 13, ~~14~~, 15, ~~16~~, 17, ~~18~~, 19, ~~20~~, ...

å–æ–°åºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°`3`ï¼Œå®ƒä¸€å®šæ˜¯ç´ æ•°ï¼Œç„¶åç”¨`3`æŠŠåºåˆ—çš„`3`çš„å€æ•°ç­›æ‰ï¼š

5, ~~6~~, 7, ~~8~~, ~~9~~, ~~10~~, 11, ~~12~~, 13, ~~14~~, ~~15~~, ~~16~~, 17, ~~18~~, 19, ~~20~~, ...

å–æ–°åºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°`5`ï¼Œç„¶åç”¨`5`æŠŠåºåˆ—çš„`5`çš„å€æ•°ç­›æ‰ï¼š

7, ~~8~~, ~~9~~, ~~10~~, 11, ~~12~~, 13, ~~14~~, ~~15~~, ~~16~~, 17, ~~18~~, 19, ~~20~~, ...

ä¸æ–­ç­›ä¸‹å»ï¼Œå°±å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„ç´ æ•°ã€‚

ç”¨ Python æ¥å®ç°è¿™ä¸ªç®—æ³•ï¼Œå¯ä»¥å…ˆæ„é€ ä¸€ä¸ªä»`3`å¼€å§‹çš„å¥‡æ•°åºåˆ—ï¼š

```python
def _odd_iter():
    n = 1
    while True:
        n = n + 2
        yield n
```

æ³¨æ„è¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ— é™åºåˆ—ã€‚

ç„¶åå®šä¹‰ä¸€ä¸ªç­›é€‰å‡½æ•°ï¼š

```python
def _not_divisible(n):
    return lambda x: x % n > 0
```

æœ€åï¼Œå®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä¸æ–­è¿”å›ä¸‹ä¸€ä¸ªç´ æ•°ï¼š

```python
def primes():
    yield 2
    it = _odd_iter() # åˆå§‹åºåˆ—
    while True:
        n = next(it) # è¿”å›åºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°
        yield n
        it = filter(_not_divisible(n), it) # æ„é€ æ–°åºåˆ—
```

è¿™ä¸ªç”Ÿæˆå™¨å…ˆè¿”å›ç¬¬ä¸€ä¸ªç´ æ•°`2`ï¼Œç„¶åï¼Œåˆ©ç”¨`filter()`ä¸æ–­äº§ç”Ÿç­›é€‰åçš„æ–°çš„åºåˆ—ã€‚

ç”±äº`primes()`ä¹Ÿæ˜¯ä¸€ä¸ªæ— é™åºåˆ—ï¼Œæ‰€ä»¥è°ƒç”¨æ—¶éœ€è¦è®¾ç½®ä¸€ä¸ªé€€å‡ºå¾ªç¯çš„æ¡ä»¶ï¼š

```python
# æ‰“å°1000ä»¥å†…çš„ç´ æ•°:
for n in primes():
    if n < 1000:
        print(n)
    else:
        break
```

æ³¨æ„åˆ°`Iterator`æ˜¯æƒ°æ€§è®¡ç®—çš„åºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ Python è¡¨ç¤ºâ€œå…¨ä½“è‡ªç„¶æ•°â€ï¼Œâ€œå…¨ä½“ç´ æ•°â€è¿™æ ·çš„åºåˆ—ï¼Œè€Œä»£ç éå¸¸ç®€æ´ã€‚

> ç»ƒä¹ é¢˜ï¼š

å›æ•°æ˜¯æŒ‡ä»å·¦å‘å³è¯»å’Œä»å³å‘å·¦è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•°ï¼Œä¾‹å¦‚`12321`ï¼Œ`909`ã€‚è¯·åˆ©ç”¨`filter()`ç­›é€‰å‡ºå›æ•°ï¼š

```python
def is_palindrome(n):
    return str(n) == str(n)[::-1]
```

æµ‹è¯•ï¼š

```python
# æµ‹è¯•:
output = filter(is_palindrome, range(1, 1000))
print('1~1000:', list(output))
if list(filter(is_palindrome, range(1, 200))) == [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 22, 33, 44, 55, 66, 77, 88, 99, 101, 111, 121, 131, 141, 151, 161, 171, 181, 191]:
    print('æµ‹è¯•æˆåŠŸ!')
else:
    print('æµ‹è¯•å¤±è´¥!')
```

> å°ç»“ï¼š

`filter()`çš„ä½œç”¨æ˜¯ä»ä¸€ä¸ªåºåˆ—ä¸­ç­›å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚ç”±äº`filter()`ä½¿ç”¨äº†æƒ°æ€§è®¡ç®—ï¼Œæ‰€ä»¥åªæœ‰åœ¨å–`filter()`ç»“æœçš„æ—¶å€™ï¼Œæ‰ä¼šçœŸæ­£ç­›é€‰å¹¶æ¯æ¬¡è¿”å›ä¸‹ä¸€ä¸ªç­›å‡ºçš„å…ƒç´ ã€‚

### 4.2.3 sorted

#### â‘  æ’åºç®—æ³•

æ’åºä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­ç»å¸¸ç”¨åˆ°çš„ç®—æ³•ã€‚æ— è®ºä½¿ç”¨å†’æ³¡æ’åºè¿˜æ˜¯å¿«é€Ÿæ’åºï¼Œæ’åºçš„æ ¸å¿ƒæ˜¯æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„å¤§å°ã€‚å¦‚æœæ˜¯æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ¯”è¾ƒï¼Œä½†å¦‚æœæ˜¯å­—ç¬¦ä¸²æˆ–è€…ä¸¤ä¸ª dictå‘¢ï¼Ÿç›´æ¥æ¯”è¾ƒæ•°å­¦ä¸Šçš„å¤§å°æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤ï¼Œæ¯”è¾ƒçš„è¿‡ç¨‹å¿…é¡»é€šè¿‡å‡½æ•°æŠ½è±¡å‡ºæ¥ã€‚

Python å†…ç½®çš„`sorted()`å‡½æ•°å°±å¯ä»¥å¯¹ list è¿›è¡Œæ’åºï¼š

```python
sorted([36, 5, -12, 9, -21])
```

![image-20200717175608860](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717175610.png)

æ­¤å¤–ï¼Œ`sorted()`å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒè¿˜å¯ä»¥æ¥æ”¶ä¸€ä¸ª`key`å‡½æ•°æ¥å®ç°è‡ªå®šä¹‰çš„æ’åºï¼Œä¾‹å¦‚æŒ‰ç»å¯¹å€¼å¤§å°æ’åºï¼š

```python
sorted([36, 5, -12, 9, -21], key=abs)
```

![image-20200717175738112](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717175739.png)

key æŒ‡å®šçš„å‡½æ•°å°†ä½œç”¨äº list çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶æ ¹æ® key å‡½æ•°è¿”å›çš„ç»“æœè¿›è¡Œæ’åºã€‚å¯¹æ¯”åŸå§‹çš„ list å’Œç»è¿‡`key=abs`å¤„ç†è¿‡çš„ listï¼š

```python
list = [36, 5, -12, 9, -21]

keys = [36, 5,  12, 9,  21]
```

ç„¶å`sorted()`å‡½æ•°æŒ‰ç…§ keys è¿›è¡Œæ’åºï¼Œå¹¶æŒ‰ç…§å¯¹åº”å…³ç³»è¿”å› list ç›¸åº”çš„å…ƒç´ ï¼š

![image-20200717180025283](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180026.png)

æˆ‘ä»¬å†çœ‹ä¸€ä¸ªå­—ç¬¦ä¸²æ’åºçš„ä¾‹å­ï¼š

```python
sorted(['bob', 'about', 'Zoo', 'Credit'])
```

![image-20200717180116413](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180117.png)

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹å­—ç¬¦ä¸²æ’åºï¼Œæ˜¯æŒ‰ç…§ ASCII çš„å¤§å°æ¯”è¾ƒçš„ï¼Œç”±äº`'Z' < 'a'`ï¼Œç»“æœï¼Œå¤§å†™å­—æ¯`Z`ä¼šæ’åœ¨å°å†™å­—æ¯`a`çš„å‰é¢ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æå‡ºæ’åºåº”è¯¥å¿½ç•¥å¤§å°å†™ï¼ŒæŒ‰ç…§å­—æ¯åºæ’åºã€‚è¦å®ç°è¿™ä¸ªç®—æ³•ï¼Œä¸å¿…å¯¹ç°æœ‰ä»£ç å¤§åŠ æ”¹åŠ¨ï¼Œåªè¦æˆ‘ä»¬èƒ½ç”¨ä¸€ä¸ª key å‡½æ•°æŠŠå­—ç¬¦ä¸²æ˜ å°„ä¸ºå¿½ç•¥å¤§å°å†™æ’åºå³å¯ã€‚å¿½ç•¥å¤§å°å†™æ¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šå°±æ˜¯å…ˆæŠŠå­—ç¬¦ä¸²éƒ½å˜æˆå¤§å†™ï¼ˆæˆ–è€…éƒ½å˜æˆå°å†™ï¼‰ï¼Œå†æ¯”è¾ƒã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬ç»™`sorted`ä¼ å…¥ key å‡½æ•°ï¼Œå³å¯å®ç°å¿½ç•¥å¤§å°å†™çš„æ’åºï¼š

```python
sorted(['bob', 'about', 'Zoo', 'Credit'], key=str.lower)
```

![image-20200717180305192](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180306.png)

è¦è¿›è¡Œåå‘æ’åºï¼Œä¸å¿…æ”¹åŠ¨ key å‡½æ•°ï¼Œå¯ä»¥ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°`reverse=True`ï¼š

```python
 sorted(['bob', 'about', 'Zoo', 'Credit'], key=str.lower, reverse=True)
```

![image-20200717180420727](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180421.png)

ä»ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œé«˜é˜¶å‡½æ•°çš„æŠ½è±¡èƒ½åŠ›æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œè€Œä¸”ï¼Œæ ¸å¿ƒä»£ç å¯ä»¥ä¿æŒå¾—éå¸¸ç®€æ´ã€‚

> å°ç»“ï¼š

`sorted()`ä¹Ÿæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ã€‚ç”¨`sorted()`æ’åºçš„å…³é”®åœ¨äºå®ç°ä¸€ä¸ªæ˜ å°„å‡½æ•°ã€‚

> ç»ƒä¹ é¢˜ï¼š

å‡è®¾æˆ‘ä»¬ç”¨ä¸€ç»„ tuple è¡¨ç¤ºå­¦ç”Ÿåå­—å’Œæˆç»©ï¼š

```python
L = [('Bob', 75), ('Adam', 92), ('Bart', 66), ('Lisa', 88)]
```

è¯·ç”¨`sorted()`å¯¹ä¸Šè¿°åˆ—è¡¨åˆ†åˆ«æŒ‰åå­—å‡åºæ’åºï¼Œå†æŒ‰æˆç»©ä»é«˜åˆ°ä½æ’åºã€‚

**ï¼ˆ1ï¼‰æŒ‰åå­—å‡åºæ’åº**

```python
L = [('Bob', 75), ('Adam', 92), ('Bart', 66), ('Lisa', 88)]
def by_name(t):
    return t[0]
L2 = sorted(L, key=by_name)
print(L2)
```

![image-20200717205002143](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717205003.png)



**ï¼ˆ2ï¼‰æŒ‰æˆç»©ä»é«˜åˆ°ä½æ’åº**

```python
L = [('Bob', 75), ('Adam', 92), ('Bart', 66), ('Lisa', 88)]
def by_name(t):
    return -t[1]
L2 = sorted(L, key=by_name)
print(L2)
```

![image-20200717205111010](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717205111.png)



## 4.x å‚è€ƒèµ„æ–™

* [å»–é›ªå³° - Python 3.x - å‡½æ•°å¼ç¼–ç¨‹](https://www.liaoxuefeng.com/wiki/1016959663602400/1017328525009056)
* [é˜®ä¸€å³° - å‡½æ•°å¼ç¼–ç¨‹åˆæ¢](http://www.ruanyifeng.com/blog/2012/04/functional_programming.html)

